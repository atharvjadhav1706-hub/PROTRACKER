<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#ffffff">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Wellness Dashboard Ultimate</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap');

    :root {
        --text-dark: #1F1F1F;
        --card-bg: rgba(255, 255, 255, 0.96);
        --c-orange: #FF9F1C;
        --c-red: #FF4D6D;
        --c-green: #2EC4B6;
        --c-blue: #3A86FF;
        --c-purple: #9D4EDD;
        --c-gold: #FFD700;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; }

    /* --- 1. PERFORMANCE & BACKGROUND --- */
    body {
        margin: 0; padding: 0;
        font-family: 'Poppins', sans-serif;
        min-height: 100vh;
        color: var(--text-dark);
        overflow-x: hidden;
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
        background-color: #f8f9fa;
    }

    body.no-scroll { overflow: hidden; height: 100vh; }

    /* GPU-Accelerated Background */
    body::before {
        content: ""; position: fixed;
        top: -50%; left: -50%; width: 200%; height: 200%;
        background: linear-gradient(300deg, #ff9a9e, #fad0c4, #fbc2eb, #a18cd1, #84fab0, #8fd3f4, #a1c4fd, #c2e9fb, #ff9a9e);
        background-size: 400% 400%;
        animation: endlessBG 12s linear infinite; 
        z-index: -1; will-change: transform; transform: translate3d(0,0,0);
    }

    @keyframes endlessBG { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }
    @keyframes stripMove { 0% { background-position: 0% 0%; } 100% { background-position: 0% 200%; } }
    @keyframes rotateBorder { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }
    @keyframes slideUpFade { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
    
    /* Smooth Pop Animation */
    @keyframes popIn { 
        0% { transform: scale(0.95); opacity: 0; } 
        100% { transform: scale(1); opacity: 1; } 
    }

    .app-container { max-width: 480px; margin: 0 auto; padding: 20px; padding-bottom: 120px; }

    /* --- HEADER --- */
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-top: 10px; }
    .greeting-label { font-size: 11px; color: #555; font-weight: 700; letter-spacing: 1.5px; margin-bottom: 4px; text-transform: uppercase; text-shadow: 0 1px 2px rgba(255,255,255,0.6); }
    .user-container { display: flex; align-items: center; gap: 8px; }
    .user-symbol { font-size: 28px; cursor: pointer; display: inline-block; min-width: 30px; text-align: center; transition: transform 0.1s; }
    .user-symbol:active { transform: scale(0.9); }
    .user-name { font-size: 28px; font-weight: 800; color: #111; border-bottom: 2px dashed transparent; min-width: 50px; }
    
    .date-pill-wrapper {
        position: relative; padding: 2px; border-radius: 50px;
        background: linear-gradient(90deg, #FF9F1C, #FF4D6D, #9D4EDD, #3A86FF, #FF9F1C);
        background-size: 300% 300%; animation: rotateBorder 4s linear infinite; 
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .date-pill { background: rgba(255,255,255,0.95); padding: 8px 16px; border-radius: 48px; font-weight: 700; font-size: 13px; color: #333; }

    /* --- CARDS --- */
    .widget-card, .card-item, .study-card {
        background: var(--card-bg); border-radius: 22px; padding: 20px; margin-bottom: 18px;
        box-shadow: 0 8px 25px -5px rgba(0,0,0,0.08); position: relative; overflow: hidden;
        border: 1px solid rgba(255,255,255,0.5); padding-left: 26px; 
        transform: translate3d(0,0,0); will-change: transform;
    }
    .widget-card:active, .study-card:active { transform: scale(0.98); transition: transform 0.1s; }

    /* Strips */
    .widget-card::before, .card-item::before, .study-card::before {
        content: ""; position: absolute; left: 0; top: 0; bottom: 0; width: 6px; z-index: 2;
        background-size: 100% 200%; animation: stripMove 5s linear infinite; 
    }
    .strip-orange::before { background-image: repeating-linear-gradient(180deg, #FF9F1C, #FF4D6D 50%, #FF9F1C 100%); }
    .strip-red::before { background-image: repeating-linear-gradient(180deg, #FF4D6D, #FF0055 50%, #FF4D6D 100%); }
    .strip-green::before { background-image: repeating-linear-gradient(180deg, #2EC4B6, #00FF99 50%, #2EC4B6 100%); }
    .strip-blue::before { background-image: repeating-linear-gradient(180deg, #3A86FF, #00D2FF 50%, #3A86FF 100%); }
    .strip-purple::before { background-image: repeating-linear-gradient(180deg, #9D4EDD, #C77DFF 50%, #9D4EDD 100%); }
    .strip-gold::before { background-image: repeating-linear-gradient(180deg, #FFD700, #FFA500 50%, #FFD700 100%); }

    /* Typography */
    .cal-header { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 12px; }
    .cal-title { font-size: 13px; font-weight: 700; color: #888; text-transform: uppercase; letter-spacing: 0.5px; }
    .cal-val { font-size: 16px; font-weight: 800; color: var(--c-orange); }
    .progress-track { height: 10px; background: rgba(0,0,0,0.05); border-radius: 10px; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, #FF9F1C, #FF4D6D); width: 0%; border-radius: 10px; transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); }

    /* Tabs */
    .cardio-tabs, .gym-tabs-container, .study-tabs-container { 
        background: rgba(0,0,0,0.04); border-radius: 50px; display: flex; padding: 4px; margin-bottom: 18px; gap: 5px; 
    }
    .c-tab, .gym-sub-tab, .study-tab { 
        flex: 1; text-align: center; padding: 10px; font-size: 13px; font-weight: 600; 
        border-radius: 48px; color: #888; cursor: pointer; transition: 0.2s; border: 2px solid transparent; background: transparent; position: relative; z-index: 1; white-space: nowrap;
    }
    .c-tab.active, .gym-sub-tab.active, .study-tab.active {
        color: #111; background: 
            linear-gradient(#fff, #fff) padding-box,
            linear-gradient(90deg, #FF9F1C, #FF4D6D, #9D4EDD, #3A86FF, #FF9F1C) border-box;
        background-size: 300% 300%; animation: rotateBorder 4s linear infinite;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .counter-display { font-size: 42px; font-weight: 800; line-height: 1; color: #111; margin-bottom: 8px; }
    .counter-unit { font-size: 16px; font-weight: 500; color: #888; }
    .ctrl-row { display: flex; justify-content: flex-end; gap: 12px; margin-top: 15px; }
    .ctrl-btn { width: 48px; height: 48px; border-radius: 50%; border: none; background: rgba(0,0,0,0.05); font-size: 22px; color: #333; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.1s;}
    .ctrl-btn:active { transform: scale(0.9); background: rgba(0,0,0,0.1); }

    /* Grid */
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
    .tile { height: 160px; display: flex; flex-direction: column; justify-content: space-between; }
    .tile-icon { width: 44px; height: 44px; border-radius: 14px; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; }
    .tile-label { font-size: 11px; font-weight: 800; color: #AAA; text-transform: uppercase; }
    .tile-main { font-size: 18px; font-weight: 700; line-height: 1.3; color: #111; }
    .tile-sub { font-size: 12px; color: #888; font-weight: 500; margin-top: 4px; }
    .tile-long { display: flex; align-items: center; justify-content: space-between; height: auto; }

    /* --- OVERLAYS --- */
    .overlay { 
        position: fixed; inset: 0; background: #F7F9FC; z-index: 900; 
        transform: translateY(100%); 
        /* Ultra Smooth iOS-like Spring Transition */
        transition: transform 0.4s cubic-bezier(0.32, 0.72, 0, 1); 
        display: flex; flex-direction: column; padding-top: env(safe-area-inset-top); padding-bottom: env(safe-area-inset-bottom);
        will-change: transform;
    }
    .overlay.open { transform: translateY(0); }
    .overlay-header { padding: 20px 25px; background: #FFFFFF; display: flex; flex-direction: column; gap: 15px; border-bottom: 1px solid rgba(0,0,0,0.05); }
    .header-top { display: flex; justify-content: space-between; align-items: center; width: 100%; }
    .ov-title { font-size: 22px; font-weight: 800; color: #111; }
    .close-btn { background: #F0F2F5; border: none; width: 36px; height: 36px; border-radius: 50%; font-size: 20px; display: flex; align-items: center; justify-content: center; cursor: pointer; color: #555; transition: 0.1s; }
    .close-btn:active { transform: scale(0.9); background: #E0E0E0; }
    .overlay-content { padding: 20px; overflow-y: auto; -webkit-overflow-scrolling: touch; flex: 1; position: relative; }

    /* --- WEIGHT TRACKER PRO --- */
    .weight-display { display: flex; justify-content: space-between; align-items: flex-end; }
    .weight-big { font-size: 42px; font-weight: 800; line-height: 1; color: var(--text-dark); }
    .weight-unit { font-size: 16px; font-weight: 600; color: #888; }
    .weight-label { font-size: 12px; font-weight: 700; color: #AAA; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;}
    
    .weight-stats-row { display: flex; gap: 10px; margin-bottom: 20px; }
    .ws-card { flex: 1; background: white; padding: 12px; border-radius: 14px; text-align: center; border: 1px solid rgba(0,0,0,0.05); box-shadow: 0 4px 10px rgba(0,0,0,0.02); }
    .ws-label { font-size: 10px; font-weight: 700; text-transform: uppercase; color: #AAA; }
    .ws-val { font-size: 16px; font-weight: 800; color: #333; margin-top: 4px; display: block;}

    #weight-canvas { width: 100%; height: 240px; background: white; border-radius: 20px; margin-bottom: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.05); border: 1px solid rgba(0,0,0,0.03); }
    
    .add-weight-card {
        background: white; border-radius: 16px; padding: 15px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 20px;
        display: flex; gap: 10px; align-items: center;
    }
    .add-input { 
        flex: 1; padding: 12px; border: 1px solid #EEE; border-radius: 12px; 
        font-family: 'Poppins', sans-serif; font-size: 16px; outline: none; background: #FAFAFA;
    }
    .add-btn { background: var(--c-purple); color: white; border: none; padding: 0 15px; border-radius: 12px; font-weight: 600; cursor: pointer; font-size: 20px; height: 46px; width: 46px; display:flex; align-items:center; justify-content:center; transition:0.1s;}
    .add-btn:active { transform: scale(0.95); }

    /* Glass Table */
    .glass-table-wrapper {
        background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
        border-radius: 20px; padding: 15px; box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.5);
    }
    .chapter-table { width: 100%; border-collapse: collapse; margin-bottom: 5px; }
    .chapter-table th { text-align: left; font-size: 11px; color: #888; font-weight: 700; padding: 8px 4px; text-transform: uppercase; }
    .chapter-table td { padding: 12px 4px; border-bottom: 1px solid rgba(0,0,0,0.05); font-size: 13px; font-weight: 600; color: #333; }
    .chapter-table tr:last-child td { border-bottom: none; }
    .del-btn { background: #FFEBEE; color: #FF4D6D; border: none; width: 30px; height: 30px; border-radius: 8px; font-weight: 700; cursor: pointer; font-size: 16px; margin-left: auto; display:block; transition:0.1s;}
    .del-btn:active { transform: scale(0.9); }
    .diff-up { color: #FF4D6D; font-size: 11px; margin-left: 5px; }
    .diff-down { color: #2EC4B6; font-size: 11px; margin-left: 5px; }

    /* --- STUDY --- */
    .neet-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white; border-radius: 20px; padding: 25px; text-align: center;
        box-shadow: 0 10px 30px -10px rgba(118, 75, 162, 0.5);
        margin-bottom: 25px; position: relative; overflow: hidden;
        animation: popIn 0.5s ease;
    }
    .neet-card::after { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 60%); animation: endlessBG 10s linear infinite; }
    .neet-label { font-size: 14px; font-weight: 600; letter-spacing: 1px; opacity: 0.9; margin-bottom: 15px; text-transform: uppercase; }
    .cd-grid { display: flex; gap: 10px; justify-content: center; position: relative; z-index: 2; }
    .cd-box { background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); border-radius: 14px; padding: 10px 5px; flex: 1; border: 1px solid rgba(255,255,255,0.3); }
    .cd-num { font-size: 26px; font-weight: 800; display: block; line-height: 1.1; text-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .cd-text { font-size: 10px; font-weight: 600; text-transform: uppercase; opacity: 0.8; }

    .study-card { height: 100px; display: flex; align-items: center; gap: 15px; cursor: pointer; transition: transform 0.2s; animation: slideUpFade 0.4s ease forwards; }
    .sc-icon { width: 50px; height: 50px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
    .sc-text h3 { margin: 0; font-size: 18px; font-weight: 700; color: #333; }
    .sc-text p { margin: 2px 0 0 0; font-size: 12px; color: #888; font-weight: 500; }
    #study-home { display: block; }
    #study-chapter-view { display: none; animation: slideUpFade 0.3s ease; }

    .add-row-stack { display: flex; flex-direction: column; gap: 10px; margin-top: 10px; background: white; padding: 15px; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); }
    .add-row-stack .add-input { width: 100%; }
    .add-row-stack .add-btn { width: 100%; height: 44px; margin-top: 5px; font-size: 16px; }

    /* Gym */
    .gym-tabs-container { overflow-x: auto; scrollbar-width: none; flex-shrink: 0; }
    .card-item.gym-item { flex-direction: row; align-items: center; justify-content: space-between; padding: 20px 20px 20px 26px; }
    .gym-left { display: flex; align-items: center; gap: 15px; flex: 1; }
    .gym-centered-info { text-align: center; flex: 1; margin-right: 40px; }
    .gym-icon { width: 40px; height: 40px; border-radius: 10px; background: rgba(58, 134, 255, 0.1); color: var(--c-blue); display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
    .gym-meta { font-size: 11px; color: #888; font-weight: 600; margin-top: 4px; display: flex; gap: 8px; justify-content: center; }
    .gym-tag { background: #F5F7FA; padding: 2px 6px; border-radius: 4px; }

    /* List Items */
    .card-item { display: flex; align-items: center; padding: 16px; margin-bottom: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); border: 1px solid #F0F0F0; animation: slideUpFade 0.4s ease forwards; opacity: 0; padding-left: 26px; }
    .cb-wrapper { position: relative; width: 26px; height: 26px; margin-right: 0; flex-shrink: 0; }
    .cb-wrapper input { position: absolute; opacity: 0; width: 100%; height: 100%; z-index: 5; cursor: pointer;}
    .cb-box { width: 100%; height: 100%; border: 2px solid #DDD; border-radius: 8px; transition: 0.2s; display: flex; align-items: center; justify-content: center; background: #FAFAFA; }
    .cb-wrapper input:checked ~ .cb-box { background: var(--c-green); border-color: var(--c-green); animation: popIn 0.3s; }
    .cb-box::after { content: ''; width: 5px; height: 10px; border: solid white; border-width: 0 2px 2px 0; transform: rotate(45deg) scale(0); transition: 0.2s; margin-top: -2px; }
    .cb-wrapper input:checked ~ .cb-box::after { transform: rotate(45deg) scale(1); }
    .item-info { flex: 1; margin-left: 15px; }
    .item-title { font-size: 14px; font-weight: 600; color: #222; line-height: 1.4; }
    .time-badge { display: inline-block; font-size: 10px; font-weight: 700; color: #888; background: #F5F5F5; padding: 4px 8px; border-radius: 6px; margin-bottom: 5px; }
    .cal-pill { display: inline-flex; align-items: center; font-size: 11px; font-weight: 700; color: var(--c-orange); background: rgba(255, 159, 28, 0.12); padding: 4px 10px; border-radius: 20px; margin-top: 6px; }

    #confetti-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; }
</style>
</head>
<body>

<canvas id="confetti-canvas"></canvas>

<div class="app-container">
    <div class="header">
        <div class="greeting-box">
            <span class="greeting-label">WELCOME BACK,</span>
            <div class="user-container">
                <span id="userSymbol" class="user-symbol" contenteditable="true">üëã</span>
                <div id="userName" class="user-name" contenteditable="true">User</div>
            </div>
        </div>
        <div class="date-pill-wrapper"><div class="date-pill" id="dateDisplay">Loading...</div></div>
    </div>

    <div class="widget-card strip-orange" onclick="openOverlay('meal')">
        <div class="cal-header"><span class="cal-title">Daily Calories</span><span class="cal-val" id="calText">0 / 0</span></div>
        <div class="progress-track"><div class="progress-fill" id="calBar"></div></div>
    </div>

    <div class="widget-card strip-red">
        <div class="cardio-tabs">
            <div class="c-tab active" id="tab-cardio" onclick="toggleCardio('cardio')">Cardio</div>
            <div class="c-tab" id="tab-steps" onclick="toggleCardio('steps')">Steps</div>
        </div>
        <div id="view-cardio">
            <div class="counter-display" id="cardioVal">0<span class="counter-unit"> min</span></div>
            <div style="height: 6px; background:#F0F0F0; border-radius:10px; overflow:hidden;"><div id="cardioProgress" style="width:0%; height:100%; background:var(--c-red); transition:0.3s;"></div></div>
            <div class="ctrl-row"><button class="ctrl-btn" onclick="updateCardio(-5)">-</button><button class="ctrl-btn" onclick="updateCardio(5)">+</button></div>
        </div>
        <div id="view-steps" style="display:none;">
            <div class="counter-display" id="stepsVal">0<span class="counter-unit"> steps</span></div>
            <div style="height: 6px; background:#F0F0F0; border-radius:10px; overflow:hidden;"><div id="stepsProgress" style="width:0%; height:100%; background:var(--c-blue); transition:0.3s;"></div></div>
            <div class="ctrl-row"><button class="ctrl-btn" onclick="updateSteps(-100)">-</button><button class="ctrl-btn" onclick="updateSteps(100)">+</button></div>
        </div>
    </div>

    <div class="widget-card strip-gold" onclick="openOverlay('weight')">
        <div class="weight-label">Weight Tracker</div>
        <div class="weight-display">
            <div><span class="weight-big" id="dashWeight">0.0</span><span class="weight-unit">kg</span></div>
            <div style="font-size: 30px;">‚öñÔ∏è</div>
        </div>
    </div>

    <div class="grid-2">
        <div class="widget-card tile strip-green" onclick="openOverlay('meal')">
            <div>
                <div class="tile-icon" style="background:#E0F2F1; color:var(--c-green);">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2v7zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4z"/></svg>
                </div>
                <div class="tile-label">Next Meal</div>
                <div class="tile-main" id="nextMealName">Loading...</div>
                <div class="tile-sub" id="nextMealTime">--:--</div>
            </div>
        </div>
        <div class="widget-card tile strip-blue" onclick="openOverlay('gym')">
            <div>
                <div class="tile-icon" style="background:#E3F2FD; color:var(--c-blue);">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2 7.71l1.43 1.43L2 10.57 3.43 12 7 8.43 15.57 17 12 20.57 13.43 22 14.86 20.57 16.29 22 18.43 19.86 19.86 21.29 21.29 19.86l-1.43-1.43L22 16.29z"/></svg>
                </div>
                <div class="tile-label">Workout</div>
                <div class="tile-main" id="workoutNamePlan">Rest Day</div>
                <div class="tile-sub">Tap to View</div>
            </div>
        </div>
    </div>

    <div class="widget-card tile-long strip-purple" onclick="openOverlay('study')">
        <div style="display:flex; flex-direction:column;">
            <div class="tile-label" style="color:var(--c-purple);">Study Mode</div>
            <div class="tile-main">Focus Tasks</div>
        </div>
        <div class="tile-icon" style="background:#F3E5F5; color:var(--c-purple); margin-bottom:0;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
        </div>
    </div>
</div>

<div id="overlay-meal" class="overlay">
    <div class="overlay-header">
        <div class="header-top"><span class="ov-title">Today's Meals</span><button class="close-btn" onclick="closeOverlay()">√ó</button></div>
    </div>
    <div class="overlay-content" id="list-meal"></div>
</div>

<div id="overlay-gym" class="overlay">
    <div class="overlay-header">
        <div class="header-top"><span class="ov-title">Gym Workout</span><button class="close-btn" onclick="closeOverlay()">√ó</button></div>
        <div id="gym-tabs-container" class="gym-tabs-container"></div>
    </div>
    <div class="overlay-content" id="list-gym"></div>
</div>

<div id="overlay-weight" class="overlay">
    <div class="overlay-header"><div class="header-top"><span class="ov-title">Weight Log</span><button class="close-btn" onclick="closeOverlay()">√ó</button></div></div>
    <div class="overlay-content">
        <div class="weight-stats-row">
            <div class="ws-card"><span class="ws-label">Current</span><span class="ws-val" id="stat-current">0 kg</span></div>
            <div class="ws-card"><span class="ws-label">Start</span><span class="ws-val" id="stat-start">0 kg</span></div>
            <div class="ws-card"><span class="ws-label">Change</span><span class="ws-val" id="stat-diff">0</span></div>
        </div>

        <canvas id="weight-canvas"></canvas>
        <div class="add-weight-card">
            <input type="date" id="weightDate" class="add-input">
            <input type="number" id="weightVal" class="add-input" placeholder="kg" style="width: 80px;">
            <button class="add-btn" onclick="addWeight()" style="background:var(--c-gold)">+</button>
        </div>
        <div class="glass-table-wrapper">
            <table class="chapter-table"><thead><tr><th>Date</th><th>Weight</th><th></th></tr></thead><tbody id="weight-list-body"></tbody></table>
        </div>
    </div>
</div>

<div id="overlay-study" class="overlay">
    <div class="overlay-header">
        <div class="header-top" id="study-header-top"><span class="ov-title" id="study-title">NEET Prep</span><button class="close-btn" onclick="closeStudyOverlay()">√ó</button></div>
    </div>
    <div class="overlay-content">
        <div id="study-home">
            <div class="neet-card">
                <div class="neet-label">NEET 2026 : 3 MAY 2026</div>
                <div class="cd-grid">
                    <div class="cd-box"><span id="cd-days" class="cd-num">000</span><span class="cd-text">Days</span></div>
                    <div class="cd-box"><span id="cd-hours" class="cd-num">00</span><span class="cd-text">Hrs</span></div>
                    <div class="cd-box"><span id="cd-mins" class="cd-num">00</span><span class="cd-text">Min</span></div>
                </div>
            </div>
            <div class="study-card strip-purple" onclick="openSubject('Physics')"><div class="sc-icon" style="background:#F3E5F5; color:#9D4EDD;">‚öõÔ∏è</div><div class="sc-text"><h3>Physics</h3><p>Mechanics, Optics...</p></div></div>
            <div class="study-card strip-orange" onclick="openSubject('Chemistry')"><div class="sc-icon" style="background:#FFF3E0; color:#FF9F1C;">üß™</div><div class="sc-text"><h3>Chemistry</h3><p>Organic, Inorganic...</p></div></div>
            <div class="study-card strip-green" onclick="openSubject('Biology')"><div class="sc-icon" style="background:#E0F2F1; color:#2EC4B6;">üß¨</div><div class="sc-text"><h3>Biology</h3><p>Botany, Zoology...</p></div></div>
        </div>
        
        <div id="study-chapter-view">
            <div class="glass-table-wrapper" id="study-list-container" style="background:transparent; box-shadow:none; border:none; padding:0;">
                </div>
            <div class="add-row-stack">
                <input type="text" id="newChapName" class="add-input" placeholder="Chapter Name">
                <input type="number" id="newChapSize" class="add-input" placeholder="Duration (min)">
                <input type="date" id="newChapDate" class="add-input">
                <button class="add-btn" onclick="addChapter()">Add Chapter</button>
            </div>
        </div>
    </div>
</div>

<script>
    // --- GLOBAL HAPTICS ---
    function triggerHaptic() { if(navigator.vibrate) navigator.vibrate(15); }
    // Attach to all buttons and interactions
    document.addEventListener('click', (e) => {
        if(e.target.tagName === 'BUTTON' || e.target.closest('.widget-card') || e.target.closest('.study-card') || e.target.tagName === 'INPUT') {
            triggerHaptic();
        }
    });

    // DATA
    const mealData = {"Sunday":[{"time":"5:00 AM","item":"Banana 120g + Roasted Chana 25g","cal":190},{"time":"9:00 AM","item":"Protein Oats 60g + Milk 200ml + Chia 10g","cal":374},{"time":"1:30 PM","item":"Chicken Breast 120g + Rice 100g","cal":328},{"time":"4:30 PM","item":"Apple 150g + Roasted Chana 40g","cal":210},{"time":"8:30 PM","item":"Goat Meat 130g + Wheat Roti 2 pcs","cal":560}],"Monday":[{"time":"5:00 AM","item":"Banana 120g + Chana 25g","cal":190},{"time":"9:00 AM","item":"Protein Oats 60g + Milk 200ml + Chia 10g","cal":374},{"time":"1:30 PM","item":"Moong Dal 100g + Black Chana 80g + Rice 120g","cal":385},{"time":"4:30 PM","item":"Apple 150g + Roasted Chana 50g","cal":250},{"time":"8:30 PM","item":"Soya Chunks 60g + Kabuli Chana 100g + Ghee 5g","cal":415}],"Tuesday":[{"time":"5:00 AM","item":"Banana 120g + Chana 25g","cal":190},{"time":"9:00 AM","item":"Omelette (3 Eggs) + Brown Bread 2 slices","cal":350},{"time":"1:30 PM","item":"Chicken Curry 150g + Rice 140g","cal":450},{"time":"4:30 PM","item":"Apple 150g + Chana 40g","cal":210},{"time":"8:30 PM","item":"Egg Bhurji (3 Eggs) + Salad 150g","cal":360}],"Wednesday":[{"time":"5:00 AM","item":"Banana 120g + Chana 25g","cal":190},{"time":"9:00 AM","item":"Protein Oats 60g + Milk 200ml","cal":325},{"time":"1:30 PM","item":"Chicken Breast 180g + Rice 120g","cal":450},{"time":"4:30 PM","item":"Apple 150g + Seeds 10g","cal":200},{"time":"8:30 PM","item":"Egg Curry (3 Eggs) + Salad 100g","cal":360}],"Thursday":[{"time":"5:00 AM","item":"Banana 120g + Chana 25g","cal":190},{"time":"9:00 AM","item":"Protein Oats 60g + Seeds 15g","cal":430},{"time":"1:30 PM","item":"Rajma 120g + Rice 150g","cal":370},{"time":"4:30 PM","item":"Fruit 150g + Chana 40g","cal":250},{"time":"8:30 PM","item":"Soya Chunks 60g + Veg Curry 200g","cal":460}],"Friday":[{"time":"5:00 AM","item":"Banana 120g + Chana 25g","cal":190},{"time":"9:00 AM","item":"Omelette (3 Eggs) + Bread 2 slices","cal":400},{"time":"1:30 PM","item":"Chicken Rice (High Protein)","cal":480},{"time":"4:30 PM","item":"Fruit 150g + Chana 40g","cal":200},{"time":"8:30 PM","item":"Egg Bhurji (3 Eggs) + Salad 150g","cal":390}],"Saturday":[{"time":"5:00 AM","item":"Banana 120g + Chana 25g","cal":190},{"time":"9:00 AM","item":"Protein Oats 60g + Seeds 15g","cal":430},{"time":"1:30 PM","item":"Dal 150g + Rice 120g + Salad","cal":420},{"time":"4:30 PM","item":"Apple 150g + Chana 50g","cal":250},{"time":"8:30 PM","item":"Soya Chunks 60g + Kabuli Chana 100g","cal":475}]};
    const gymData = {"Monday":[{"part":"Chest","ex":["Barbell Bench Press","Incline Dumbbell Press","Chest Fly","Cable Crossover","Decline Bench Press"]},{"part":"Triceps","ex":["Close Grip Bench Press","Skull Crushers","Tricep Pushdown","Overhead Dumbbell Extension","Tricep Kickbacks"]},{"part":"Bodyweight","ex":["Push-ups","Dips"]}],"Tuesday":[{"part":"Back","ex":["Deadlift","Lat Pulldown","Seated Cable Row","Bent Over Row","T-Bar Row"]},{"part":"Biceps","ex":["Barbell Curl","Dumbbell Curl","Hammer Curl","Concentration Curl","Cable Curl"]},{"part":"Bodyweight","ex":["Pull-ups"]}],"Wednesday":[{"part":"Legs","ex":["Squats","Leg Press","Lunges","Leg Curl","Leg Extension"]},{"part":"Shoulders","ex":["Overhead Press","Lateral Raise","Front Raise","Rear Delt Fly","Shrugs"]}],"Thursday":[{"part":"Chest","ex":["Barbell Bench Press","Incline Dumbbell Press","Chest Fly","Cable Crossover","Decline Bench Press"]},{"part":"Triceps","ex":["Close Grip Bench Press","Skull Crushers","Tricep Pushdown","Overhead Dumbbell Extension","Tricep Kickbacks"]},{"part":"Bodyweight","ex":["Push-ups","Dips"]}],"Friday":[{"part":"Back","ex":["Deadlift","Lat Pulldown","Seated Cable Row","Bent Over Row","T-Bar Row"]},{"part":"Biceps","ex":["Barbell Curl","Dumbbell Curl","Hammer Curl","Concentration Curl","Cable Curl"]},{"part":"Bodyweight","ex":["Pull-ups"]}],"Saturday":[{"part":"Legs","ex":["Squats","Leg Press","Lunges","Leg Curl","Leg Extension"]},{"part":"Shoulders","ex":["Overhead Press","Lateral Raise","Front Raise","Rear Delt Fly","Shrugs"]}],"Sunday":[{"part":"Recovery","ex":["Light Cardio","Stretching","Mobility","Core Training"]}]};

    const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
    let currentOverlay = null;
    let activeGymTab = 0; 
    let activeStudyTab = null;
    let studyData = JSON.parse(localStorage.getItem('study_data')) || { Physics: [], Chemistry: [], Biology: [] };
    let weightData = JSON.parse(localStorage.getItem('weight_data')) || [];

    // --- ANIMATED GRAPH VARS ---
    let drawProgress = 0;
    let animationFrameId;

    function init() {
        const now = new Date();
        const dayName = days[now.getDay()];
        document.getElementById('dateDisplay').innerText = `${dayName.substring(0,3).toUpperCase()}, ${now.getDate()} ${now.toLocaleString('default', { month: 'short' }).toUpperCase()}`;
        
        const storedName = localStorage.getItem('user_name');
        if(storedName) document.getElementById('userName').innerText = storedName;
        document.getElementById('userName').addEventListener('input', (e) => localStorage.setItem('user_name', e.target.innerText));

        updateDashboard(dayName);
        loadCardioState();
        startNeetCountdown();
        updateWeightDisplay();
        
        const todayKey = now.toDateString();
        if (localStorage.getItem('last_active_date') !== todayKey) {
            localStorage.setItem('checked_items', JSON.stringify([]));
            localStorage.setItem('cardio_min', '0');
            localStorage.setItem('steps_count', '0');
            localStorage.setItem('last_active_date', todayKey);
            location.reload(); 
        }
        document.getElementById('weightDate').valueAsDate = new Date();
        document.getElementById('newChapDate').valueAsDate = new Date();
    }

    function updateDashboard(dayName) {
        const meals = mealData[dayName] || [];
        const now = new Date();
        let nextMeal = meals.find(m => {
            let parts = m.time.split(/[: ]/);
            let h = parseInt(parts[0]); if(parts[2]==="PM" && h!==12) h+=12; if(parts[2]==="AM" && h===12) h=0;
            let mealTime = new Date(); mealTime.setHours(h, parseInt(parts[1]), 0);
            return mealTime > now;
        }) || meals[0];
        if (nextMeal) {
            document.getElementById('nextMealName').innerText = nextMeal.item.split(/\d/)[0].trim().substring(0,12) + "...";
            document.getElementById('nextMealTime').innerText = `At ${nextMeal.time}`;
        }
        const workout = gymData[dayName];
        if(workout) {
            const parts = workout.map(w => w.part).join(" & ");
            document.getElementById('workoutNamePlan').innerText = parts.length > 18 ? parts.substring(0, 18) + "..." : parts;
        }
        renderLists(dayName, false);
    }

    function toggleCardio(type) {
        document.querySelectorAll('.c-tab').forEach(t => t.classList.remove('active'));
        document.getElementById(`tab-${type}`).classList.add('active');
        document.getElementById('view-cardio').style.display = type === 'cardio' ? 'block' : 'none';
        document.getElementById('view-steps').style.display = type === 'steps' ? 'block' : 'none';
    }

    function updateCardio(val) { let n = Math.max(0, parseInt(localStorage.getItem('cardio_min')||0) + val); localStorage.setItem('cardio_min', n); loadCardioState(); }
    function updateSteps(val) { let n = Math.max(0, parseInt(localStorage.getItem('steps_count')||0) + val); localStorage.setItem('steps_count', n); loadCardioState(); }
    function loadCardioState() {
        const c = parseInt(localStorage.getItem('cardio_min')||0);
        const s = parseInt(localStorage.getItem('steps_count')||0);
        document.getElementById('cardioVal').innerHTML = `${c}<span class="counter-unit"> min</span>`;
        document.getElementById('cardioProgress').style.width = Math.min((c/30)*100, 100)+'%';
        document.getElementById('stepsVal').innerHTML = `${s}<span class="counter-unit"> steps</span>`;
        document.getElementById('stepsProgress').style.width = Math.min((s/10000)*100, 100)+'%';
    }

    window.openOverlay = function(type) {
        document.body.classList.add('no-scroll');
        currentOverlay = `overlay-${type}`;
        document.getElementById(currentOverlay).classList.add('open');
        if(type === 'study') {
            document.getElementById('study-home').style.display = 'block';
            document.getElementById('study-chapter-view').style.display = 'none';
            document.getElementById('study-title').innerText = "NEET Prep";
            const h = document.getElementById('study-header-top');
            if(h.querySelector('.back-btn-study')) h.querySelector('.back-btn-study').remove();
        } else if (type === 'weight') {
            renderWeightLog(); 
            // Reset Animation
            drawProgress = 0; 
            if(animationFrameId) cancelAnimationFrame(animationFrameId);
            animateGraph();
            updateWeightDisplay();
        } else {
            renderLists(days[new Date().getDay()], true);
        }
    }

    window.closeOverlay = function() {
        if(currentOverlay) {
            document.getElementById(currentOverlay).classList.remove('open');
            currentOverlay = null;
            document.body.classList.remove('no-scroll');
        }
    }
    
    // --- WEIGHT LOGIC ---
    window.addWeight = function() {
        const d = document.getElementById('weightDate').value;
        const w = parseFloat(document.getElementById('weightVal').value);
        if(d && w && w < 110) { 
            weightData.push({date: d, weight: w});
            weightData.sort((a,b) => new Date(b.date) - new Date(a.date));
            localStorage.setItem('weight_data', JSON.stringify(weightData));
            document.getElementById('weightVal').value = '';
            renderWeightLog(); 
            drawProgress = 0; animateGraph(); 
            updateWeightDisplay();
        }
    }
    
    function updateWeightDisplay() {
        if(weightData.length > 0) {
            const sorted = [...weightData].sort((a,b) => new Date(a.date) - new Date(b.date));
            const current = sorted[sorted.length-1].weight;
            const start = sorted[0].weight;
            const diff = (current - start).toFixed(1);
            
            document.getElementById('dashWeight').innerText = current;
            document.getElementById('stat-current').innerText = current + " kg";
            document.getElementById('stat-start').innerText = start + " kg";
            document.getElementById('stat-diff').innerHTML = diff > 0 ? `+${diff} kg` : `${diff} kg`;
            document.getElementById('stat-diff').style.color = diff > 0 ? "#FF4D6D" : "#2EC4B6";
        }
    }

    function renderWeightLog() {
        const tbody = document.getElementById('weight-list-body');
        tbody.innerHTML = '';
        const sorted = [...weightData].sort((a,b) => new Date(b.date) - new Date(a.date));
        
        sorted.forEach((item, index) => {
            let diffHtml = '';
            if (index < sorted.length - 1) {
                const prev = sorted[index+1].weight;
                const d = (item.weight - prev).toFixed(1);
                if(d != 0) diffHtml = d > 0 ? `<span class='diff-up'>‚ñ≤ ${d}</span>` : `<span class='diff-down'>‚ñº ${Math.abs(d)}</span>`;
            }
            tbody.innerHTML += `<tr><td>${item.date}</td><td>${item.weight} kg ${diffHtml}</td><td><button class="del-btn" onclick="deleteWeight(${index})">√ó</button></td></tr>`;
        });
    }

    window.deleteWeight = function(index) {
        weightData.sort((a,b) => new Date(b.date) - new Date(a.date));
        weightData.splice(index, 1);
        localStorage.setItem('weight_data', JSON.stringify(weightData));
        renderWeightLog(); drawProgress = 0; animateGraph(); updateWeightDisplay();
    }

    // ANIMATED GRAPH
    function animateGraph() {
        if (drawProgress < 1) {
            drawProgress += 0.02; // Speed
            drawWeightChart(drawProgress);
            animationFrameId = requestAnimationFrame(animateGraph);
        } else {
            drawWeightChart(1);
        }
    }

    function drawWeightChart(progress = 1) {
        const canvas = document.getElementById('weight-canvas');
        const ctx = canvas.getContext('2d');
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width; canvas.height = rect.height;
        
        const min = 0; const max = 110;
        
        ctx.clearRect(0,0,canvas.width, canvas.height);
        
        // Grid
        ctx.beginPath(); ctx.strokeStyle = 'rgba(0,0,0,0.05)'; ctx.lineWidth = 1;
        for(let i=1; i<5; i++) {
            let y = (canvas.height/5)*i;
            ctx.moveTo(0, y); ctx.lineTo(canvas.width, y);
            ctx.fillStyle = "#CCC"; ctx.font = "10px Poppins"; ctx.fillText((110 - (22*i)), 5, y - 5);
        }
        ctx.stroke();

        if(weightData.length < 2) return;
        
        const sorted = [...weightData].sort((a,b) => new Date(a.date) - new Date(b.date));
        const weights = sorted.map(d => d.weight);
        
        // Dynamic Line Drawing
        const pointsToDraw = Math.floor(weights.length * progress);
        
        ctx.beginPath(); ctx.strokeStyle = '#FFD700'; ctx.lineWidth = 4;
        ctx.shadowColor = "rgba(255, 215, 0, 0.5)"; ctx.shadowBlur = 10;
        
        const stepX = canvas.width / (weights.length - 1 || 1);
        const heightRange = canvas.height - 40;
        
        weights.forEach((w, i) => {
            const x = i * stepX; 
            const y = canvas.height - ((w - min) / (max - min)) * heightRange - 20;
            if (i > pointsToDraw) return; // Animation clipping

            if(i===0) ctx.moveTo(x, y); 
            else {
                const prevX = (i-1)*stepX;
                const prevY = canvas.height - ((weights[i-1]-min)/(max-min))*heightRange - 20;
                const midX = (prevX+x)/2;
                ctx.bezierCurveTo(midX, prevY, midX, y, x, y);
            }
        });
        ctx.stroke();
        ctx.shadowBlur = 0;
        
        // Gradient (Only if full draw)
        if(progress > 0.9) {
            ctx.lineTo(canvas.width, canvas.height); ctx.lineTo(0, canvas.height);
            const grad = ctx.createLinearGradient(0,0,0,canvas.height);
            grad.addColorStop(0, "rgba(255, 215, 0, 0.2)"); grad.addColorStop(1, "rgba(255, 215, 0, 0.0)");
            ctx.fillStyle = grad; ctx.fill();
        }

        // Dots
        if(progress > 0.9) {
            weights.forEach((w, i) => {
                const x = i * stepX;
                const y = canvas.height - ((w - min) / (max - min)) * heightRange - 20;
                ctx.beginPath(); ctx.arc(x, y, 5, 0, Math.PI*2);
                ctx.fillStyle = "white"; ctx.strokeStyle="#FFD700"; ctx.lineWidth=3; ctx.fill(); ctx.stroke();
            });
        }
    }

    // --- STUDY LOGIC ---
    window.closeStudyOverlay = function() {
        if(document.getElementById('study-chapter-view').style.display === 'block') {
            document.getElementById('study-chapter-view').style.display = 'none';
            document.getElementById('study-home').style.display = 'block';
            document.getElementById('study-title').innerText = "NEET Prep";
            const btn = document.querySelector('.back-btn-study');
            if(btn) btn.remove();
        } else { closeOverlay(); }
    }

    window.openSubject = function(subject) {
        activeStudyTab = subject;
        document.getElementById('study-home').style.display = 'none';
        document.getElementById('study-chapter-view').style.display = 'block';
        document.getElementById('study-title').innerText = subject;
        const h = document.getElementById('study-header-top');
        if(!h.querySelector('.back-btn-study')) {
            const b = document.createElement('button'); b.className = 'close-btn back-btn-study';
            b.innerText = '‚Üê'; b.style.marginRight = '10px'; b.onclick = () => closeStudyOverlay();
            h.prepend(b);
        }
        renderStudyList();
    }

    function renderStudyList() {
        if(!studyData[activeStudyTab]) studyData[activeStudyTab] = [];
        const container = document.getElementById('study-list-container');
        container.innerHTML = '';
        
        studyData[activeStudyTab].forEach((item, index) => {
            const isChecked = item.completed ? 'checked' : '';
            const html = `
            <div class="card-item strip-purple">
                <label class="cb-wrapper">
                    <input type="checkbox" id="study-${index}" ${isChecked} onchange="toggleStudyCheck(${index}, event)">
                    <div class="cb-box"></div>
                </label>
                <div class="item-info">
                    <div class="item-title">${item.name}</div>
                    <div class="gym-meta" style="justify-content: flex-start; margin-top:5px;">
                        <span class="gym-tag">${item.date}</span>
                        <span class="gym-tag">${item.size}m</span>
                    </div>
                </div>
                <button class="del-btn" onclick="deleteChapter(${index})">√ó</button>
            </div>`;
            container.innerHTML += html;
        });
    }

    window.toggleStudyCheck = function(index, event) {
        studyData[activeStudyTab][index].completed = !studyData[activeStudyTab][index].completed;
        localStorage.setItem('study_data', JSON.stringify(studyData));
        if(event.target.checked) {
            const r = event.target.closest('.cb-wrapper').getBoundingClientRect();
            triggerHistoryBlast(r.left+r.width/2, r.top+r.height/2);
        }
    }

    window.addChapter = function() {
        const n = document.getElementById('newChapName').value.trim();
        const s = document.getElementById('newChapSize').value.trim();
        const d = document.getElementById('newChapDate').value;
        
        if(n && s && d) {
            // GLOBAL DATE LOCK
            let count = 0;
            Object.values(studyData).forEach(list => {
                list.forEach(c => { if(c.date === d) count++; });
            });
            
            if(count >= 2) {
                alert("Daily Limit Reached: Max 2 chapters per day allowed!");
                return;
            }

            studyData[activeStudyTab].push({name:n, size:s, date:d, completed: false});
            localStorage.setItem('study_data', JSON.stringify(studyData));
            document.getElementById('newChapName').value = '';
            document.getElementById('newChapSize').value = '';
            renderStudyList();
        } else {
            alert("Please fill all fields");
        }
    }

    window.deleteChapter = function(index) {
        if(confirm("Delete this chapter?")) {
            studyData[activeStudyTab].splice(index, 1);
            localStorage.setItem('study_data', JSON.stringify(studyData));
            renderStudyList();
        }
    }

    function startNeetCountdown() {
        const target = new Date("May 3, 2026 00:00:00").getTime();
        setInterval(() => {
            const now = new Date().getTime(), diff = target - now;
            if(diff > 0) {
                document.getElementById('cd-days').innerText = String(Math.floor(diff / 86400000)).padStart(3,'0');
                document.getElementById('cd-hours').innerText = String(Math.floor((diff % 86400000) / 3600000)).padStart(2,'0');
                document.getElementById('cd-mins').innerText = String(Math.floor((diff % 3600000) / 60000)).padStart(2,'0');
            }
        }, 1000);
    }

    window.setGymTab = function(index) { activeGymTab = index; renderLists(days[new Date().getDay()], true); }

    function renderLists(dayName, renderDOM = true) {
        const checked = JSON.parse(localStorage.getItem('checked_items') || "[]");
        let mData = mealData[dayName] || [];
        let totalCal = 0, eatenCal = 0;
        let mHtml = '';
        
        mData.forEach((m, i) => {
            let id = `meal-${i}`;
            let isChecked = checked.includes(id);
            totalCal += m.cal; 
            if(isChecked) eatenCal += m.cal;
            
            if(renderDOM) {
                mHtml += `<div class="card-item strip-green">
                    <label class="cb-wrapper"><input type="checkbox" id="${id}" ${isChecked?'checked':''} onchange="toggleCheck('${id}', event)"><div class="cb-box"></div></label>
                    <div class="item-info"><span class="time-badge">${m.time}</span><div class="item-title">${m.item}</div><div class="cal-pill">üî• ${m.cal}</div></div>
                </div>`;
            }
        });

        if(document.getElementById('calText')) {
            document.getElementById('calText').innerText = `${eatenCal} / ${totalCal}`;
            document.getElementById('calBar').style.width = totalCal ? (eatenCal/totalCal)*100+'%' : '0%';
        }

        if(renderDOM && document.getElementById('list-meal')) document.getElementById('list-meal').innerHTML = mHtml;

        const gymGroups = gymData[dayName] || [];
        const gymTabs = document.getElementById('gym-tabs-container');
        const gymList = document.getElementById('list-gym');

        if(renderDOM && gymTabs && gymList) {
            if(gymGroups.length > 1) {
                if(gymTabs.getAttribute('data-day') !== dayName) {
                    let h = ''; gymGroups.forEach((g,i) => h += `<button class="gym-sub-tab" onclick="setGymTab(${i})">${g.part}</button>`);
                    gymTabs.innerHTML = h; gymTabs.setAttribute('data-day', dayName); gymTabs.style.display = 'flex';
                }
                Array.from(gymTabs.children).forEach((b,i) => b.classList.toggle('active', i===activeGymTab));
            } else { gymTabs.style.display = 'none'; activeGymTab = 0; }

            const group = gymGroups[activeGymTab];
            if(group) {
                let h = '';
                group.ex.forEach((ex, i) => {
                    const id = `gym-${days.indexOf(dayName)}-${activeGymTab}-${i}`;
                    let title = ex.replace(/^\d+\.\s*/, '');
                    let icon = 'üí™';
                    if(title.toLowerCase().includes('bench')) icon='üèãÔ∏è'; else if(title.toLowerCase().includes('dumb')) icon='ü¶æ';
                    
                    h += `<div class="card-item gym-item strip-blue">
                        <div class="gym-left">
                            <label class="cb-wrapper"><input type="checkbox" id="${id}" ${checked.includes(id)?'checked':''} onchange="toggleCheck('${id}', event)"><div class="cb-box"></div></label>
                            <div class="gym-centered-info">
                                <div class="item-title">${title}</div>
                                <div class="gym-meta"><span class="gym-tag">3 Sets</span><span class="gym-tag">8-12 Reps</span></div>
                            </div>
                        </div>
                        <div class="gym-icon">${icon}</div>
                    </div>`;
                });
                gymList.innerHTML = h;
            } else { gymList.innerHTML = '<div style="text-align:center;color:#999;">Rest Day</div>'; }
        }
    }

    window.toggleCheck = function(id, event) {
        let checked = JSON.parse(localStorage.getItem('checked_items') || "[]");
        if(document.getElementById(id).checked) {
            checked.push(id);
            const r = event.target.closest('.cb-wrapper').getBoundingClientRect();
            triggerHistoryBlast(r.left+r.width/2, r.top+r.height/2);
        } else { checked = checked.filter(i => i !== id); }
        localStorage.setItem('checked_items', JSON.stringify(checked));
        renderLists(days[new Date().getDay()], true); 
    }

    function triggerHistoryBlast(x, y) {
        if(navigator.vibrate) navigator.vibrate([30, 40, 30]);
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        let p = [];
        for(let i=0; i<60; i++) {
            const a = Math.random()*Math.PI*2, v = Math.random()*15+5;
            p.push({x:x, y:y, c:['#FFD700','#32CD32'][Math.floor(Math.random()*2)], vx:Math.cos(a)*v, vy:Math.sin(a)*v, l:100});
        }
        function loop() {
            ctx.clearRect(0,0,canvas.width,canvas.height);
            let a = false;
            p.forEach(k => {
                if(k.l>0) { a=true; k.x+=k.vx; k.y+=k.vy; k.vy+=0.6; k.l-=2; ctx.fillStyle=k.c; ctx.fillRect(k.x,k.y,6,6); }
            });
            if(a) requestAnimationFrame(loop);
        }
        loop();
    }

    init();
</script>
</body>
</html>
