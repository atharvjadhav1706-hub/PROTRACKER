<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fitness Pro - Final</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        /* --- 1. PERFORMANCE OPTIMIZED BACKGROUND --- */
        @keyframes misty-drift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .bg-whitish-dim {
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0, #cbd5e1);
            background-size: 200% 200%;
            animation: misty-drift 20s ease infinite;
            color: #0f172a;
            will-change: background-position; /* GPU Hint */
        }

        /* --- 2. LEFT STRIP ANIMATION --- */
        @keyframes strip-flow { 0% { background-position: 0% 0%; } 100% { background-position: 0% 200%; } }
        .strip-gradient {
            background: linear-gradient(to bottom, #ef4444, #fbbf24, #2563eb, #ef4444);
            background-size: 100% 200%;
            animation: strip-flow 5s linear infinite;
            will-change: background-position;
        }

        /* --- 3. FLUID PROGRESS BARS --- */
        @keyframes fluid-flow { 0% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .bar-cardio { background: linear-gradient(90deg, #0ea5e9, #38bdf8, #0284c7, #0ea5e9); background-size: 200% 100%; animation: fluid-flow 2s linear infinite; }
        .bar-steps { background: linear-gradient(90deg, #10b981, #4ade80, #059669, #10b981); background-size: 200% 100%; animation: fluid-flow 2s linear infinite; }

        /* --- 4. OPTIMIZED GLASS (Low Blur for Speed) --- */
        .glass {
            background: rgba(255, 255, 255, 0.9); /* Higher opacity */
            backdrop-filter: blur(8px); /* Low blur = High FPS */
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            transform: translateZ(0); /* Force GPU rendering */
        }
        
        /* Utils */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        input:focus { outline: none; }
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        * { -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
    </style>
</head>
<body class="bg-whitish-dim min-h-screen font-sans p-4 pb-24 select-none">

    <div class="flex items-center justify-between mb-6 pt-4">
        <div class="flex items-center gap-3">
            <div class="relative w-14 h-14 cursor-pointer group shrink-0" onclick="document.getElementById('profileUpload').click()">
                <div class="w-full h-full rounded-full overflow-hidden border-2 border-white shadow-md relative bg-slate-200">
                    <img id="profileImg" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" class="w-full h-full object-cover">
                </div>
                <div class="absolute bottom-0 right-0 bg-slate-800 p-1 rounded-full border border-white shadow-sm">
                    <svg class="w-2.5 h-2.5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" /></svg>
                </div>
                <canvas id="resizeCanvas" class="hidden"></canvas>
                <input type="file" id="profileUpload" class="hidden" accept="image/*" onchange="processProfilePic(this)">
            </div>
            
            <div class="flex flex-col justify-center">
                <label class="text-[9px] font-black text-slate-400 tracking-[0.2em] leading-none mb-1">HELLO,</label>
                <input type="text" id="userNameInput" value="USER" onchange="saveData()" class="bg-transparent text-2xl font-black uppercase w-40 text-slate-900 border-none p-0 leading-none focus:text-blue-600 transition-colors placeholder-slate-300 truncate">
            </div>
        </div>

        <button onclick="openStatsModal()" class="w-10 h-10 bg-white rounded-xl shadow-sm border border-slate-100 flex items-center justify-center active:scale-90 transition-all text-slate-400 hover:text-blue-600">
            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
        </button>
    </div>

    <div class="glass relative w-full rounded-2xl overflow-hidden mb-5 p-5 pl-7 shadow-sm">
        <div class="absolute left-0 top-0 bottom-0 w-2 strip-gradient"></div>
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-[10px] font-black text-slate-400 tracking-widest uppercase">DAILY TARGETS</h3>
            <span class="text-[9px] font-bold text-blue-600 bg-blue-50 px-3 py-1 rounded-lg cursor-pointer hover:bg-blue-100 transition" onclick="openStatsModal()">CONFIGURE</span>
        </div>
        
        <div class="grid grid-cols-3 gap-3 text-center">
            <div class="bg-emerald-50/80 p-2.5 rounded-2xl border border-emerald-100">
                <div class="text-[9px] font-black text-emerald-600 mb-1 tracking-wider">LOSS</div>
                <div id="calLoss" class="text-sm font-black text-slate-800">--</div>
            </div>
            <div class="bg-blue-50/80 p-2.5 rounded-2xl border border-blue-100 scale-105 shadow-sm z-10">
                <div class="text-[9px] font-black text-blue-600 mb-1 tracking-wider">MAINTAIN</div>
                <div id="calMaintain" class="text-lg font-black text-slate-800">--</div>
            </div>
            <div class="bg-orange-50/80 p-2.5 rounded-2xl border border-orange-100">
                <div class="text-[9px] font-black text-orange-600 mb-1 tracking-wider">GAIN</div>
                <div id="calGain" class="text-sm font-black text-slate-800">--</div>
            </div>
        </div>
    </div>

    <div class="glass relative w-full rounded-2xl overflow-hidden mb-5">
        <div class="absolute left-0 top-0 bottom-0 w-2 strip-gradient"></div>
        <div class="p-5 pl-7 flex items-center justify-between">
            <div>
                <p class="text-[10px] font-black text-slate-400 tracking-widest uppercase mb-1">Current Streak</p>
                <div class="flex items-center gap-2">
                    <span id="streakCount" class="text-5xl font-black italic text-slate-800">0</span>
                    <span class="text-3xl filter drop-shadow-sm">üèÜ</span>
                </div>
            </div>
            <div class="text-[9px] font-bold text-slate-400 text-right max-w-[80px] leading-tight">
                CONSISTENCY<br>IS THE ONLY<br>MAGIC
            </div>
        </div>
    </div>

    <div onclick="openModal()" class="glass relative w-full rounded-2xl overflow-hidden mb-5 active:scale-[0.98] transition-transform shadow-sm cursor-pointer">
        <div class="absolute left-0 top-0 bottom-0 w-2 strip-gradient"></div>
        <div class="p-5 pl-7 flex justify-between items-center">
            <div class="flex-1 pr-2">
                <h2 class="text-2xl font-black italic tracking-tighter uppercase text-slate-800 mb-2">Today's Workout</h2>
                <div id="todayPreview" class="text-[10px] font-bold text-blue-700 uppercase tracking-widest bg-blue-50/80 border border-blue-100 px-3 py-1.5 rounded-lg inline-block"></div>
            </div>
            <div class="relative w-20 h-20 shrink-0">
                <svg class="w-full h-full -rotate-90 filter drop-shadow-sm">
                    <defs>
                        <linearGradient id="gymGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" stop-color="#3b82f6"><animate attributeName="stop-color" values="#3b82f6;#ec4899;#eab308;#3b82f6" dur="3s" repeatCount="indefinite" /></stop>
                            <stop offset="100%" stop-color="#ec4899"><animate attributeName="stop-color" values="#ec4899;#eab308;#3b82f6;#ec4899" dur="3s" repeatCount="indefinite" /></stop>
                        </linearGradient>
                    </defs>
                    <circle cx="40" cy="40" r="34" stroke="currentColor" stroke-width="6" fill="transparent" class="text-slate-200" />
                    <circle id="circleRing" cx="40" cy="40" r="34" stroke="url(#gymGrad)" stroke-width="6" fill="transparent" class="transition-all duration-700" stroke-dasharray="213" stroke-dashoffset="213" stroke-linecap="round"/>
                </svg>
                <div class="absolute inset-0 flex items-center justify-center">
                    <span id="gymPercent" class="text-lg font-black text-slate-800 tracking-tighter">0%</span>
                </div>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-2 gap-3 mb-5">
        <div class="glass relative rounded-2xl overflow-hidden flex flex-col justify-between h-44">
            <div class="absolute left-0 top-0 bottom-0 w-2 strip-gradient"></div>
            <div class="p-4 pl-6 h-full flex flex-col justify-between">
                <div>
                    <span class="text-[9px] font-black tracking-widest uppercase text-slate-400 block mb-1">CARDIO</span>
                    <div class="flex items-baseline gap-0.5">
                        <input type="number" id="cardioInput" value="0" onchange="updateVal('cardio', this.value)" class="bg-transparent w-full text-3xl font-black text-slate-800 border-none p-0 leading-none">
                        <span class="text-[9px] text-slate-400 font-bold shrink-0 self-end mb-1">/ 30m</span>
                    </div>
                </div>
                <div class="w-full bg-slate-200 h-2 rounded-full overflow-hidden">
                    <div id="cardioBar" class="bar-cardio h-full rounded-full transition-all duration-500 w-0 shadow-sm"></div>
                </div>
                <button onclick="addVal('cardio', 5)" class="w-full py-3 bg-slate-800 rounded-xl text-[10px] font-bold uppercase text-white hover:bg-slate-700 active:scale-95 transition-all shadow-md">+ 5 MIN</button>
            </div>
        </div>
        <div class="glass relative rounded-2xl overflow-hidden flex flex-col justify-between h-44">
            <div class="absolute left-0 top-0 bottom-0 w-2 strip-gradient"></div>
            <div class="p-4 pl-6 h-full flex flex-col justify-between">
                <div>
                    <span class="text-[9px] font-black tracking-widest uppercase text-slate-400 block mb-1">STEPS</span>
                    <div class="flex items-baseline gap-0.5">
                        <input type="number" id="stepsInput" value="0" onchange="updateVal('steps', this.value)" class="bg-transparent w-full text-2xl font-black text-slate-800 border-none p-0 leading-none">
                        <span class="text-[9px] text-slate-400 font-bold shrink-0 self-end mb-1">/ 10k</span>
                    </div>
                </div>
                <div class="w-full bg-slate-200 h-2 rounded-full overflow-hidden">
                    <div id="stepsBar" class="bar-steps h-full rounded-full transition-all duration-500 w-0 shadow-sm"></div>
                </div>
                <button onclick="addVal('steps', 1000)" class="w-full py-3 bg-slate-800 rounded-xl text-[10px] font-bold uppercase text-white hover:bg-slate-700 active:scale-95 transition-all shadow-md">+ 1000</button>
            </div>
        </div>
    </div>

    <div class="glass relative w-full rounded-2xl overflow-hidden shadow-sm">
        <div class="absolute left-0 top-0 bottom-0 w-2 strip-gradient"></div>
        <div class="p-5 pl-7">
            <div class="flex justify-between items-center mb-4">
                <span class="text-[10px] font-black tracking-widest uppercase text-slate-400">WEIGHT TREND</span>
                <div class="flex items-baseline border-b border-slate-200">
                     <input type="number" id="weightInput" value="75.0" onchange="updateWeight(this.value)" class="bg-transparent text-right w-20 text-2xl font-black text-slate-800 border-none p-0 focus:ring-0">
                     <span class="text-[10px] font-bold text-slate-400 ml-1">KG</span>
                </div>
            </div>
            <div class="w-full h-16 flex items-end opacity-80">
                 <svg viewBox="0 0 100 40" class="w-full h-full overflow-visible">
                    <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
                        <feDropShadow dx="0" dy="2" stdDeviation="2" flood-color="rgba(59, 130, 246, 0.3)"/>
                    </filter>
                    <path d="M0,35 C20,35 20,28 40,28 C60,28 60,18 80,18 C90,18 90,22 100,22" fill="none" stroke="#3b82f6" stroke-width="3" stroke-linecap="round" filter="url(#glow)" />
                    <circle cx="100" cy="22" r="4" fill="#3b82f6" stroke="white" stroke-width="2" class="animate-pulse"/>
                 </svg>
            </div>
        </div>
    </div>

    <div id="statsModal" class="fixed inset-0 z-50 bg-slate-900/60 hidden flex-col justify-center items-center backdrop-blur-md p-6">
        <div class="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl relative border border-slate-100 transform transition-all scale-100">
            <h2 class="text-xl font-black text-slate-800 mb-6 uppercase text-center tracking-wide">Configure Stats</h2>
            
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="text-[10px] font-bold text-slate-400 block mb-1.5 uppercase">Age</label>
                    <input type="number" id="ageInput" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 font-bold text-slate-700 focus:ring-2 focus:ring-blue-500 focus:outline-none" placeholder="25">
                </div>
                <div>
                    <label class="text-[10px] font-bold text-slate-400 block mb-1.5 uppercase">Height (CM)</label>
                    <input type="number" id="heightInput" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 font-bold text-slate-700 focus:ring-2 focus:ring-blue-500 focus:outline-none" placeholder="175">
                </div>
            </div>

            <div class="mb-4">
                <label class="text-[10px] font-bold text-slate-400 block mb-1.5 uppercase">Current Weight (KG)</label>
                <input type="number" id="modalWeightInput" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 font-bold text-slate-700 focus:ring-2 focus:ring-blue-500 focus:outline-none">
            </div>

            <label class="text-[10px] font-bold text-slate-400 block mb-1.5 uppercase">Gender</label>
            <div class="flex gap-3 mb-4">
                <button onclick="setGender('male')" id="btnMale" class="flex-1 py-3 rounded-xl font-bold bg-slate-50 border border-slate-200 text-slate-400 transition hover:bg-slate-100">MALE</button>
                <button onclick="setGender('female')" id="btnFemale" class="flex-1 py-3 rounded-xl font-bold bg-slate-50 border border-slate-200 text-slate-400 transition hover:bg-slate-100">FEMALE</button>
            </div>

            <label class="text-[10px] font-bold text-slate-400 block mb-1.5 uppercase">Activity Level</label>
            <div class="relative mb-6">
                <select id="activityInput" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 font-bold text-slate-700 appearance-none focus:ring-2 focus:ring-blue-500 focus:outline-none">
                    <option value="1.2">Sedentary (Office Job)</option>
                    <option value="1.375">Light Activity (1-3 days)</option>
                    <option value="1.55">Moderate (3-5 days)</option>
                    <option value="1.725">Active (6-7 days)</option>
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-slate-500">
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </div>
            </div>

            <button onclick="saveStats()" class="w-full bg-blue-600 text-white py-4 rounded-xl font-black uppercase tracking-widest shadow-lg shadow-blue-300 active:scale-95 transition-transform">Calculate & Save</button>
            <button onclick="document.getElementById('statsModal').classList.add('hidden')" class="w-full mt-3 text-slate-400 font-bold text-xs py-2 hover:text-slate-600 transition-colors">CANCEL</button>
        </div>
    </div>

    <div id="workoutModal" class="fixed inset-0 z-50 bg-[#f8fafc] hidden flex-col overflow-y-auto">
        <div class="p-6 flex justify-between items-center sticky top-0 bg-[#f8fafc]/95 backdrop-blur-xl z-10 border-b border-slate-200 shadow-sm">
            <div class="strip-gradient p-[2px] rounded-full">
                <div class="bg-white px-6 py-2 rounded-full shadow-sm">
                    <span id="modalDay" class="text-sm font-black uppercase tracking-widest text-slate-800"></span>
                </div>
            </div>
            <button onclick="closeModal()" class="w-12 h-12 rounded-full bg-slate-200 text-slate-600 flex items-center justify-center text-2xl font-bold shadow-sm active:scale-95 transition-transform hover:bg-slate-300">‚úï</button>
        </div>
        <div class="p-6 pb-20">
            <div id="modalTabs" class="flex gap-3 mb-8"></div>
            <div id="modalExercises" class="flex flex-col gap-4"></div>
        </div>
    </div>

    <script>
        // CONFIG
        const today = new Date();
        const days = ['SUNDAY', 'MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY', 'SATURDAY'];
        const dayName = days[today.getDay()];
        const dateKey = today.toLocaleDateString(); 

        const workouts = {
            'MONDAY': { tabs: ['Chest', 'Triceps'], ex: [['Barbell Bench Press', 'Incline Dumbbell Press', 'Machine Chest Fly', 'Seated Chest Press', 'Cable Crossovers'], ['Skullcrushers (EZ Bar)', 'Rope Pushdowns', 'Overhead Dumbbell Extension', 'Close Grip Bench Press', 'Triceps Dip Machine']] },
            'TUESDAY': { tabs: ['Back', 'Biceps'], ex: [['Lat Pulldown Machine', 'Seated Cable Row', 'T-Bar Row', 'Barbell Deadlift', 'Single Arm Dumbbell Row'], ['Barbell Bicep Curl', 'Dumbbell Hammer Curl', 'Preacher Curl Machine', 'Standing Cable Curl', 'Concentration Curl']] },
            'WEDNESDAY': { tabs: ['Legs', 'Shoulders'], ex: [['Leg Press Machine', 'Hack Squat Machine', 'Leg Extensions', 'Lying Leg Curls', 'Standing Calf Raise'], ['Overhead Shoulder Press', 'Dumbbell Lateral Raise', 'Dumbbell Front Raise', 'Rear Delt Fly', 'Barbell Shrugs']] },
            'THURSDAY': { tabs: ['Chest Variation', 'Triceps Variation'], ex: [['Dumbbell Flat Bench Press', 'Hammer Strength Incline Press', 'Low-to-High Cable Fly', 'Smith Machine Press', 'Decline Chest Press'], ['V-Bar Pushdowns', 'French Press', 'Dumbbell Kickbacks', 'Reverse Grip Pushdown', 'Single Arm Cable Extension']] },
            'FRIDAY': { tabs: ['Back Variation', 'Biceps Variation'], ex: [['Reverse Grip Pulldown', 'Bent Over Barbell Row', 'Meadows Row', 'Rack Pulls', 'Straight Arm Pulldown'], ['Incline Dumbbell Curl', 'Spider Curls', 'Zottman Curls', 'EZ Bar Curls', 'Bayesian Cable Curls']] },
            'SATURDAY': { tabs: ['Legs Variation', 'Shoulders Variation'], ex: [['Goblet Squat', 'Romanian Deadlift', 'Bulgarian Split Squat', 'Hip Thrust Machine', 'Seated Calf Raise'], ['Arnold Dumbbell Press', 'Cable Lateral Raise', 'Face Pulls', 'Upright Rows', 'Machine Shoulder Press']] },
            'SUNDAY': { tabs: ['Rest Day', 'Recovery'], ex: [[], []] }
        };

        // STATE
        let currentTab = 0;
        let checks = Array(10).fill(false);
        let streak = 0; 
        let streakLocked = false;
        let cardioVal = 0;
        let stepsVal = 0;
        let weightVal = 75.0;
        let userName = "USER";
        let profilePic = "https://api.dicebear.com/7.x/avataaars/svg?seed=Felix";
        let stats = { age: 25, height: 175, gender: 'male', activity: 1.55 };

        function init() {
            loadData();
            const w = workouts[dayName];
            document.getElementById('todayPreview').innerText = `${w.tabs[0]} & ${w.tabs[1]}`;
            document.getElementById('modalDay').innerText = dayName;
            document.getElementById('userNameInput').value = userName;
            document.getElementById('streakCount').innerText = streak;
            document.getElementById('weightInput').value = weightVal;
            document.getElementById('profileImg').src = profilePic;
            
            // Sync Stats
            document.getElementById('ageInput').value = stats.age;
            document.getElementById('heightInput').value = stats.height;
            document.getElementById('activityInput').value = stats.activity;
            document.getElementById('modalWeightInput').value = weightVal;
            updateGenderUI();
            
            calculateCalories();
            updateVal('cardio', cardioVal, false);
            updateVal('steps', stepsVal, false);
            renderTabs();
            renderExercises();
            updateGymCircle();
        }

        // DATA LAYER
        function saveData() {
            const data = {
                date: dateKey,
                user: document.getElementById('userNameInput').value,
                streak: streak,
                streakLocked: streakLocked,
                weight: parseFloat(document.getElementById('weightInput').value) || 0,
                cardio: cardioVal,
                steps: stepsVal,
                checks: checks,
                profilePic: profilePic,
                stats: stats
            };
            try { localStorage.setItem('fitnessProData', JSON.stringify(data)); } catch(e) { alert("Storage full!"); }
        }

        function loadData() {
            const raw = localStorage.getItem('fitnessProData');
            if(raw) {
                const data = JSON.parse(raw);
                userName = data.user || "USER";
                weightVal = parseFloat(data.weight) || 75.0;
                streak = data.streak || 0;
                profilePic = data.profilePic || "https://api.dicebear.com/7.x/avataaars/svg?seed=Felix";
                stats = data.stats || { age: 25, height: 175, gender: 'male', activity: 1.55 };

                if(data.date === dateKey) {
                    cardioVal = data.cardio || 0;
                    stepsVal = data.steps || 0;
                    checks = data.checks || Array(10).fill(false);
                    streakLocked = data.streakLocked || false;
                } else {
                    cardioVal = 0; stepsVal = 0; checks = Array(10).fill(false); streakLocked = false; saveData();
                }
            }
        }

        function processProfilePic(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = function() {
                        const canvas = document.getElementById('resizeCanvas');
                        const ctx = canvas.getContext('2d');
                        const maxSize = 200; // Resize to max 200px
                        let width = img.width;
                        let height = img.height;
                        if (width > height) { if (width > maxSize) { height *= maxSize / width; width = maxSize; } } 
                        else { if (height > maxSize) { width *= maxSize / height; height = maxSize; } }
                        canvas.width = width;
                        canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        profilePic = canvas.toDataURL('image/jpeg', 0.85);
                        document.getElementById('profileImg').src = profilePic;
                        saveData();
                    }
                }
                reader.readAsDataURL(file);
            }
        }

        // LOGIC
        function openStatsModal() {
            document.getElementById('modalWeightInput').value = document.getElementById('weightInput').value;
            document.getElementById('statsModal').classList.remove('hidden');
            document.getElementById('statsModal').classList.add('flex');
        }

        function setGender(g) { stats.gender = g; updateGenderUI(); }
        function updateGenderUI() {
            const m = document.getElementById('btnMale'), f = document.getElementById('btnFemale');
            const active = "bg-blue-600 text-white border-transparent";
            const inactive = "bg-slate-50 text-slate-400 border-slate-200";
            if(stats.gender === 'male') { m.className = `flex-1 py-3 rounded-xl font-bold transition ${active}`; f.className = `flex-1 py-3 rounded-xl font-bold transition ${inactive}`; }
            else { f.className = `flex-1 py-3 rounded-xl font-bold transition ${active}`; m.className = `flex-1 py-3 rounded-xl font-bold transition ${inactive}`; }
        }

        function saveStats() {
            stats.age = parseFloat(document.getElementById('ageInput').value) || 25;
            stats.height = parseFloat(document.getElementById('heightInput').value) || 175;
            stats.activity = parseFloat(document.getElementById('activityInput').value);
            // Sync Weight Logic
            const newW = parseFloat(document.getElementById('modalWeightInput').value) || weightVal;
            document.getElementById('weightInput').value = newW;
            weightVal = newW;
            
            calculateCalories();
            saveData();
            document.getElementById('statsModal').classList.add('hidden');
        }

        function calculateCalories() {
            const w = weightVal;
            // Mifflin-St Jeor
            let bmr = (10 * w) + (6.25 * stats.height) - (5 * stats.age) + (stats.gender === 'male' ? 5 : -161);
            const tdee = Math.round(bmr * stats.activity);
            
            document.getElementById('calMaintain').innerText = tdee;
            document.getElementById('calLoss').innerText = tdee - 500;
            document.getElementById('calGain').innerText = tdee + 300;
        }

        function updateWeight(val) { 
            weightVal = parseFloat(val) || 0; 
            calculateCalories(); 
            saveData(); 
        }

        function openModal() { document.getElementById('workoutModal').classList.remove('hidden'); document.getElementById('workoutModal').classList.add('flex'); }
        function closeModal() { document.getElementById('workoutModal').classList.add('hidden'); document.getElementById('workoutModal').classList.remove('flex'); }
        function switchTab(i) { currentTab = i; renderTabs(); renderExercises(); }
        
        function renderTabs() { 
            const w = workouts[dayName]; 
            document.getElementById('modalTabs').innerHTML = w.tabs.map((t, i) => 
                `<button onclick="switchTab(${i})" class="flex-1 py-4 rounded-xl text-xs font-black uppercase tracking-widest transition-all ${currentTab === i ? 'bg-blue-600 text-white shadow-lg' : 'bg-white border border-slate-200 text-gray-400'}">${t}</button>`
            ).join(''); 
        }

        function renderExercises() {
            const w = workouts[dayName];
            if(dayName === 'SUNDAY') { document.getElementById('modalExercises').innerHTML = '<div class="text-center mt-10 opacity-50 font-bold text-slate-800 text-xl">REST DAY</div>'; return; }
            const list = w.ex[currentTab], offset = currentTab * 5;
            document.getElementById('modalExercises').innerHTML = list.map((name, i) => {
                const id = offset + i;
                return `<label class="glass p-5 rounded-xl flex items-center gap-5 cursor-pointer active:scale-[0.99] transition-transform shadow-sm group select-none"><div class="relative shrink-0 w-8 h-8"><input type="checkbox" ${checks[id] ? 'checked' : ''} onchange="toggleCheck(${id}, this)" class="peer appearance-none w-full h-full rounded-lg border-2 border-slate-300 bg-white checked:bg-blue-600 checked:border-blue-600 transition-all"><svg class="absolute inset-0 m-auto w-5 h-5 text-white opacity-0 peer-checked:opacity-100 transition-opacity pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" /></svg></div><span class="text-base font-bold text-slate-800 leading-tight group-hover:text-blue-700 transition-colors">${name}</span></label>`;
            }).join('');
        }

        function toggleCheck(id, el) { 
            checks[id] = el.checked; 
            if(navigator.vibrate) navigator.vibrate(50); 
            if(el.checked) confetti({ particleCount: 80, spread: 80, origin: { y: 0.6 }, colors: ['#FFD700', '#FF1493', '#F472B6', '#EAB308'] }); 
            updateGymCircle(); 
            saveData(); 
        }

        function updateGymCircle() { 
            const done = checks.filter(Boolean).length, pct = Math.round((done / 10) * 100); 
            document.getElementById('circleRing').style.strokeDashoffset = 213 - (213 * pct / 100); 
            document.getElementById('gymPercent').innerText = pct + "%"; 
            if(done === 10 && !streakLocked) { streak++; streakLocked = true; } 
            else if (done < 10 && streakLocked) { streak--; streakLocked = false; } 
            document.getElementById('streakCount').innerText = streak; 
        }

        function updateVal(type, val, save=true) { 
            let v = parseInt(val), max = type === 'cardio' ? 30 : 10000; 
            if(v > max) v = max; if(v < 0) v = 0; 
            if(type === 'cardio') cardioVal = v; 
            if(type === 'steps') stepsVal = v; 
            document.getElementById(`${type}Input`).value = v; 
            document.getElementById(`${type}Bar`).style.width = (v / max * 100) + '%'; 
            if(save) saveData(); 
        }

        function addVal(type, amt) { 
            let curr = parseInt(document.getElementById(`${type}Input`).value); 
            updateVal(type, curr + amt); 
        }

        init();
    </script>
</body>
</html>
