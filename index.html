<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fitness Pro - Delete Button</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        /* --- 1. BACKGROUND --- */
        @keyframes misty-drift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .bg-whitish-dim {
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0, #cbd5e1);
            background-size: 200% 200%;
            animation: misty-drift 20s ease infinite;
            color: #0f172a;
            will-change: background-position;
        }

        /* --- 2. STRIPS & GRADIENTS --- */
        @keyframes strip-flow { 0% { background-position: 0% 0%; } 100% { background-position: 0% 200%; } }
        .strip-gradient {
            background: linear-gradient(to bottom, #ef4444, #fbbf24, #2563eb, #ef4444);
            background-size: 100% 200%;
            animation: strip-flow 5s linear infinite;
            will-change: background-position;
        }

        @keyframes fluid-flow { 0% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .bar-cardio { background: linear-gradient(90deg, #0ea5e9, #38bdf8, #0284c7, #0ea5e9); background-size: 200% 100%; animation: fluid-flow 2s linear infinite; }
        .bar-steps { background: linear-gradient(90deg, #10b981, #4ade80, #059669, #10b981); background-size: 200% 100%; animation: fluid-flow 2s linear infinite; }

        /* --- 3. GLASS UI --- */
        .glass {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 4px 12px -2px rgba(0, 0, 0, 0.05);
            transform: translateZ(0);
        }

        /* --- 4. HISTORY LIST STYLES --- */
        .history-item { transition: background-color 0.2s; user-select: none; }
        /* Utils */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        input:focus { outline: none; }
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        * { -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
    </style>
</head>
<body class="bg-whitish-dim min-h-screen font-sans p-4 pb-24 select-none">

    <div class="flex items-center justify-between mb-6 pt-4">
        <div class="flex items-center gap-3">
            <div class="relative w-14 h-14 cursor-pointer group shrink-0" onclick="document.getElementById('profileUpload').click()">
                <div class="w-full h-full rounded-full overflow-hidden border-2 border-white shadow-md relative bg-slate-200">
                    <img id="profileImg" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" class="w-full h-full object-cover">
                </div>
                <div class="absolute bottom-0 right-0 bg-slate-800 p-1 rounded-full border border-white shadow-sm">
                    <svg class="w-2.5 h-2.5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" /></svg>
                </div>
                <canvas id="resizeCanvas" class="hidden"></canvas>
                <input type="file" id="profileUpload" class="hidden" accept="image/*" onchange="processProfilePic(this)">
            </div>
            
            <div class="flex flex-col justify-center">
                <label class="text-[9px] font-black text-slate-400 tracking-[0.2em] leading-none mb-1">HELLO,</label>
                <input type="text" id="userNameInput" value="USER" onchange="saveData()" class="bg-transparent text-2xl font-black uppercase w-40 text-slate-900 border-none p-0 leading-none focus:text-blue-600 transition-colors placeholder-slate-300 truncate">
            </div>
        </div>

        <button onclick="openStatsModal()" class="w-10 h-10 bg-white rounded-xl shadow-sm border border-slate-100 flex items-center justify-center active:scale-90 transition-all text-slate-400 hover:text-blue-600">
            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
        </button>
    </div>

    <div class="glass relative w-full rounded-2xl overflow-hidden mb-5 p-5 pl-7 shadow-sm">
        <div class="absolute left-0 top-0 bottom-0 w-2 strip-gradient"></div>
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-[10px] font-black text-slate-400 tracking-widest uppercase">DAILY TARGETS</h3>
            <span class="text-[9px] font-bold text-blue-600 bg-blue-50 px-3 py-1 rounded-lg cursor-pointer hover:bg-blue-100 transition" onclick="openStatsModal()">CONFIGURE</span>
        </div>
        <div class="grid grid-cols-3 gap-3 text-center">
            <div class="bg-emerald-50/80 p-2.5 rounded-2xl border border-emerald-100"><div class="text-[9px] font-black text-emerald-600 mb-1 tracking-wider">LOSS</div><div id="calLoss" class="text-sm font-black text-slate-800">--</div></div>
            <div class="bg-blue-50/80 p-2.5 rounded-2xl border border-blue-100 scale-105 shadow-sm z-10"><div class="text-[9px] font-black text-blue-600 mb-1 tracking-wider">MAINTAIN</div><div id="calMaintain" class="text-lg font-black text-slate-800">--</div></div>
            <div class="bg-orange-50/80 p-2.5 rounded-2xl border border-orange-100"><div class="text-[9px] font-black text-orange-600 mb-1 tracking-wider">GAIN</div><div id="calGain" class="text-sm font-black text-slate-800">--</div></div>
        </div>
    </div>

    <div class="glass relative w-full rounded-2xl overflow-hidden mb-5">
        <div class="absolute left-0 top-0 bottom-0 w-2 strip-gradient"></div>
        <div class="p-5 pl-7 flex items-center justify-between">
            <div><p class="text-[10px] font-black text-slate-400 tracking-widest uppercase mb-1">Current Streak</p><div class="flex items-center gap-2"><span id="streakCount" class="text-5xl font-black italic text-slate-800">0</span><span class="text-3xl filter drop-shadow-sm">üèÜ</span></div></div>
            <div class="text-[9px] font-bold text-slate-400 text-right max-w-[80px] leading-tight">CONSISTENCY<br>IS THE ONLY<br>MAGIC</div>
        </div>
    </div>

    <div onclick="openModal()" class="glass relative w-full rounded-2xl overflow-hidden mb-5 active:scale-[0.98] transition-transform shadow-sm cursor-pointer">
        <div class="absolute left-0 top-0 bottom-0 w-2 strip-gradient"></div>
        <div class="p-5 pl-7 flex justify-between items-center">
            <div class="flex-1 pr-2"><h2 class="text-2xl font-black italic tracking-tighter uppercase text-slate-800 mb-2">Today's Workout</h2><div id="todayPreview" class="text-[10px] font-bold text-blue-700 uppercase tracking-widest bg-blue-50/80 border border-blue-100 px-3 py-1.5 rounded-lg inline-block"></div></div>
            <div class="relative w-20 h-20 shrink-0">
                <svg class="w-full h-full -rotate-90 filter drop-shadow-sm"><defs><linearGradient id="gymGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#3b82f6"><animate attributeName="stop-color" values="#3b82f6;#ec4899;#eab308;#3b82f6" dur="3s" repeatCount="indefinite" /></stop><stop offset="100%" stop-color="#ec4899"><animate attributeName="stop-color" values="#ec4899;#eab308;#3b82f6;#ec4899" dur="3s" repeatCount="indefinite" /></stop></linearGradient></defs><circle cx="40" cy="40" r="34" stroke="currentColor" stroke-width="6" fill="transparent" class="text-slate-200" /><circle id="circleRing" cx="40" cy="40" r="34" stroke="url(#gymGrad)" stroke-width="6" fill="transparent" class="transition-all duration-700" stroke-dasharray="213" stroke-dashoffset="213" stroke-linecap="round"/></svg>
                <div class="absolute inset-0 flex items-center justify-center"><span id="gymPercent" class="text-lg font-black text-slate-800 tracking-tighter">0%</span></div>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-2 gap-3 mb-5">
        <div class="glass relative rounded-2xl overflow-hidden flex flex-col justify-between h-44">
            <div class="absolute left-0 top-0 bottom-0 w-2 strip-gradient"></div>
            <div class="p-4 pl-6 h-full flex flex-col justify-between"><div><span class="text-[9px] font-black tracking-widest uppercase text-slate-400 block mb-1">CARDIO</span><div class="flex items-baseline gap-0.5"><input type="number" id="cardioInput" value="0" onchange="updateVal('cardio', this.value)" class="bg-transparent w-full text-3xl font-black text-slate-800 border-none p-0 leading-none"><span class="text-[9px] text-slate-400 font-bold shrink-0 self-end mb-1">/ 30m</span></div></div><div class="w-full bg-slate-200 h-2 rounded-full overflow-hidden"><div id="cardioBar" class="bar-cardio h-full rounded-full transition-all duration-500 w-0 shadow-sm"></div></div><button onclick="addVal('cardio', 5)" class="w-full py-3 bg-slate-800 rounded-xl text-[10px] font-bold uppercase text-white hover:bg-slate-700 active:scale-95 transition-all shadow-md">+ 5 MIN</button></div>
        </div>
        <div class="glass relative rounded-2xl overflow-hidden flex flex-col justify-between h-44">
            <div class="absolute left-0 top-0 bottom-0 w-2 strip-gradient"></div>
            <div class="p-4 pl-6 h-full flex flex-col justify-between"><div><span class="text-[9px] font-black tracking-widest uppercase text-slate-400 block mb-1">STEPS</span><div class="flex items-baseline gap-0.5"><input type="number" id="stepsInput" value="0" onchange="updateVal('steps', this.value)" class="bg-transparent w-full text-2xl font-black text-slate-800 border-none p-0 leading-none"><span class="text-[9px] text-slate-400 font-bold shrink-0 self-end mb-1">/ 10k</span></div></div><div class="w-full bg-slate-200 h-2 rounded-full overflow-hidden"><div id="stepsBar" class="bar-steps h-full rounded-full transition-all duration-500 w-0 shadow-sm"></div></div><button onclick="addVal('steps', 1000)" class="w-full py-3 bg-slate-800 rounded-xl text-[10px] font-bold uppercase text-white hover:bg-slate-700 active:scale-95 transition-all shadow-md">+ 1000</button></div>
        </div>
    </div>

    <div onclick="openWeightModal()" class="glass relative w-full rounded-2xl overflow-hidden shadow-sm active:scale-[0.98] transition-transform cursor-pointer">
        <div class="absolute left-0 top-0 bottom-0 w-2 strip-gradient"></div>
        <div class="p-5 pl-7 flex justify-between items-center">
            <div>
                <span class="text-[10px] font-black tracking-widest uppercase text-slate-400">BODY WEIGHT</span>
                <div class="flex items-baseline mt-1">
                    <span id="displayWeight" class="text-3xl font-black text-slate-800 tracking-tighter">--</span>
                    <span class="text-xs font-bold text-slate-400 ml-1">KG</span>
                </div>
                <div id="bmiDisplayMain" class="mt-2 text-[9px] font-bold text-slate-500 bg-slate-100 px-2 py-0.5 rounded inline-block uppercase">BMI: --</div>
            </div>
            <div class="w-10 h-10 bg-slate-50 rounded-full flex items-center justify-center text-slate-400">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>
            </div>
        </div>
    </div>

    <div id="statsModal" class="fixed inset-0 z-50 bg-slate-900/60 hidden flex-col justify-center items-center backdrop-blur-md p-6">
        <div class="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl relative border border-slate-100 transform transition-all scale-100">
            <h2 class="text-xl font-black text-slate-800 mb-6 uppercase text-center tracking-wide">Configure Stats</h2>
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div><label class="text-[10px] font-bold text-slate-400 block mb-1.5 uppercase">Age</label><input type="number" id="ageInput" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 font-bold text-slate-700 focus:outline-none" placeholder="25"></div>
                <div><label class="text-[10px] font-bold text-slate-400 block mb-1.5 uppercase">Height (CM)</label><input type="number" id="heightInput" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 font-bold text-slate-700 focus:outline-none" placeholder="175"></div>
            </div>
            <div class="mb-4"><label class="text-[10px] font-bold text-slate-400 block mb-1.5 uppercase">Weight (KG)</label><input type="number" id="modalWeightInput" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 font-bold text-slate-700 focus:outline-none"></div>
            <div class="flex gap-3 mb-4">
                <button onclick="setGender('male')" id="btnMale" class="flex-1 py-3 rounded-xl font-bold bg-slate-50 text-slate-400 transition">MALE</button>
                <button onclick="setGender('female')" id="btnFemale" class="flex-1 py-3 rounded-xl font-bold bg-slate-50 text-slate-400 transition">FEMALE</button>
            </div>
            <div class="relative mb-6">
                <select id="activityInput" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 font-bold text-slate-700 appearance-none outline-none"><option value="1.2">Sedentary</option><option value="1.375">Light Activity</option><option value="1.55">Moderate</option><option value="1.725">Active</option></select>
            </div>
            <button onclick="saveStats()" class="w-full bg-blue-600 text-white py-4 rounded-xl font-black uppercase tracking-widest shadow-lg shadow-blue-300 active:scale-95 transition-transform">Save & Calculate</button>
            <button onclick="document.getElementById('statsModal').classList.add('hidden')" class="w-full mt-3 text-slate-400 font-bold text-xs py-2 hover:text-slate-600 transition-colors">CANCEL</button>
        </div>
    </div>

    <div id="weightModal" class="fixed inset-0 z-50 bg-[#f8fafc] hidden flex-col overflow-y-auto">
        <div class="p-6 flex justify-between items-center sticky top-0 bg-[#f8fafc]/95 backdrop-blur-xl z-10 border-b border-slate-200 shadow-sm">
            <h2 class="text-lg font-black uppercase text-slate-800 tracking-widest">Weight Tracker</h2>
            <button onclick="closeWeightModal()" class="w-12 h-12 rounded-full bg-slate-200 text-slate-600 flex items-center justify-center text-2xl font-bold shadow-sm active:scale-95 hover:bg-slate-300">‚úï</button>
        </div>
        
        <div class="p-6 pb-20">
            <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-100 mb-6">
                <div class="flex gap-3 mb-3">
                    <div class="flex-1">
                        <label class="text-[10px] font-bold text-slate-400 block mb-1 uppercase">Date</label>
                        <input type="date" id="weightDateInput" class="w-full bg-slate-50 border-2 border-slate-200 rounded-xl p-3 font-bold text-slate-700 focus:outline-none">
                    </div>
                    <div class="w-24">
                        <label class="text-[10px] font-bold text-slate-400 block mb-1 uppercase">KG</label>
                        <input type="number" id="newWeightInput" placeholder="0.0" class="w-full bg-slate-50 border-2 border-slate-200 rounded-xl p-3 font-black text-slate-800 focus:border-blue-500 focus:outline-none">
                    </div>
                </div>
                <button onclick="logNewWeight()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold uppercase tracking-widest shadow-lg shadow-blue-300 active:scale-95 transition">SAVE LOG</button>
            </div>

            <div class="bg-white rounded-2xl p-4 border border-slate-100 shadow-lg mb-6">
                <div class="flex justify-between items-end mb-4">
                    <span class="text-[10px] font-bold text-slate-400 uppercase">Trend (0 - 110 KG)</span>
                    <span id="modalCurrentWeight" class="text-xl font-black text-slate-800">-- KG</span>
                </div>
                <div class="relative w-full h-40 border-l border-b border-slate-200">
                    <div class="absolute left-0 bottom-[45%] w-full h-[1px] bg-slate-100 border-t border-dashed border-slate-300"></div>
                    <div class="absolute left-0 bottom-[90%] w-full h-[1px] bg-slate-100 border-t border-dashed border-slate-300"></div>
                    <svg id="weightChart" class="w-full h-full overflow-visible" preserveAspectRatio="none">
                        <path id="chartLine" d="" fill="none" stroke="#3b82f6" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
                        <g id="chartDots"></g>
                    </svg>
                </div>
            </div>

            <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3">History Log</h3>
            <div id="historyList" class="flex flex-col gap-2"></div>
        </div>
    </div>

    <div id="deleteModal" class="fixed inset-0 z-[60] bg-black/50 hidden items-center justify-center backdrop-blur-sm">
        <div class="bg-white p-6 rounded-2xl shadow-2xl max-w-xs w-full text-center m-4">
            <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4 text-red-600"><svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg></div>
            <h3 class="text-lg font-black text-slate-800 mb-2">Delete Entry?</h3>
            <p class="text-sm text-slate-500 mb-6">Are you sure you want to remove this weight log?</p>
            <div class="flex gap-3"><button onclick="cancelDelete()" class="flex-1 py-3 bg-slate-100 rounded-xl font-bold text-slate-500">Cancel</button><button onclick="confirmDelete()" class="flex-1 py-3 bg-red-600 rounded-xl font-bold text-white shadow-lg shadow-red-200">Delete</button></div>
        </div>
    </div>

    <div id="workoutModal" class="fixed inset-0 z-50 bg-[#f8fafc] hidden flex-col overflow-y-auto">
        <div class="p-6 flex justify-between items-center sticky top-0 bg-[#f8fafc]/95 backdrop-blur-xl z-10 border-b border-slate-200 shadow-sm"><div class="strip-gradient p-[2px] rounded-full"><div class="bg-white px-6 py-2 rounded-full shadow-sm"><span id="modalDay" class="text-sm font-black uppercase tracking-widest text-slate-800"></span></div></div><button onclick="closeModal()" class="w-12 h-12 rounded-full bg-slate-200 text-slate-600 flex items-center justify-center text-2xl font-bold shadow-sm active:scale-95 transition-transform hover:bg-slate-300">‚úï</button></div>
        <div class="p-6 pb-20"><div id="modalTabs" class="flex gap-3 mb-8"></div><div id="modalExercises" class="flex flex-col gap-4"></div></div>
    </div>

    <script>
        // CONFIG
        const today = new Date();
        const days = ['SUNDAY', 'MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY', 'SATURDAY'];
        const dayName = days[today.getDay()];
        const dateKey = today.toLocaleDateString(); 

        const workouts = {
            'MONDAY': { tabs: ['Chest', 'Triceps'], ex: [['Barbell Bench Press', 'Incline Dumbbell Press', 'Machine Chest Fly', 'Seated Chest Press', 'Cable Crossovers'], ['Skullcrushers (EZ Bar)', 'Rope Pushdowns', 'Overhead Dumbbell Extension', 'Close Grip Bench Press', 'Triceps Dip Machine']] },
            'TUESDAY': { tabs: ['Back', 'Biceps'], ex: [['Lat Pulldown Machine', 'Seated Cable Row', 'T-Bar Row', 'Barbell Deadlift', 'Single Arm Dumbbell Row'], ['Barbell Bicep Curl', 'Dumbbell Hammer Curl', 'Preacher Curl Machine', 'Standing Cable Curl', 'Concentration Curl']] },
            'WEDNESDAY': { tabs: ['Legs', 'Shoulders'], ex: [['Leg Press Machine', 'Hack Squat Machine', 'Leg Extensions', 'Lying Leg Curls', 'Standing Calf Raise'], ['Overhead Shoulder Press', 'Dumbbell Lateral Raise', 'Dumbbell Front Raise', 'Rear Delt Fly', 'Barbell Shrugs']] },
            'THURSDAY': { tabs: ['Chest Variation', 'Triceps Variation'], ex: [['Dumbbell Flat Bench Press', 'Hammer Strength Incline Press', 'Low-to-High Cable Fly', 'Smith Machine Press', 'Decline Chest Press'], ['V-Bar Pushdowns', 'French Press', 'Dumbbell Kickbacks', 'Reverse Grip Pushdown', 'Single Arm Cable Extension']] },
            'FRIDAY': { tabs: ['Back Variation', 'Biceps Variation'], ex: [['Reverse Grip Pulldown', 'Bent Over Barbell Row', 'Meadows Row', 'Rack Pulls', 'Straight Arm Pulldown'], ['Incline Dumbbell Curl', 'Spider Curls', 'Zottman Curls', 'EZ Bar Curls', 'Bayesian Cable Curls']] },
            'SATURDAY': { tabs: ['Legs Variation', 'Shoulders Variation'], ex: [['Goblet Squat', 'Romanian Deadlift', 'Bulgarian Split Squat', 'Hip Thrust Machine', 'Seated Calf Raise'], ['Arnold Dumbbell Press', 'Cable Lateral Raise', 'Face Pulls', 'Upright Rows', 'Machine Shoulder Press']] },
            'SUNDAY': { tabs: ['Rest Day', 'Recovery'], ex: [[], []] }
        };

        // STATE
        let currentTab = 0, checks = Array(10).fill(false), streak = 0, streakLocked = false, cardioVal = 0, stepsVal = 0;
        let userName = "USER", profilePic = "https://api.dicebear.com/7.x/avataaars/svg?seed=Felix";
        let stats = { age: 25, height: 175, gender: 'male', activity: 1.55 };
        let weightHistory = []; 
        let deleteIndex = -1;

        function init() {
            loadData();
            const w = workouts[dayName];
            document.getElementById('todayPreview').innerText = `${w.tabs[0]} & ${w.tabs[1]}`;
            document.getElementById('modalDay').innerText = dayName;
            document.getElementById('userNameInput').value = userName;
            document.getElementById('streakCount').innerText = streak;
            document.getElementById('profileImg').src = profilePic;
            
            document.getElementById('ageInput').value = stats.age;
            document.getElementById('heightInput').value = stats.height;
            document.getElementById('activityInput').value = stats.activity;
            updateGenderUI();
            document.getElementById('weightDateInput').valueAsDate = new Date();

            refreshWeightUI();
            updateVal('cardio', cardioVal, false);
            updateVal('steps', stepsVal, false);
            renderTabs();
            renderExercises();
            updateGymCircle();
        }

        // DATA
        function saveData() {
            const data = { date: dateKey, user: document.getElementById('userNameInput').value, streak: streak, streakLocked: streakLocked, cardio: cardioVal, steps: stepsVal, checks: checks, profilePic: profilePic, stats: stats, weightHistory: weightHistory };
            try { localStorage.setItem('fitnessProData', JSON.stringify(data)); } catch(e) { alert("Storage full!"); }
        }

        function loadData() {
            const raw = localStorage.getItem('fitnessProData');
            if(raw) {
                const data = JSON.parse(raw);
                userName = data.user || "USER"; streak = data.streak || 0; profilePic = data.profilePic || "https://api.dicebear.com/7.x/avataaars/svg?seed=Felix"; stats = data.stats || { age: 25, height: 175, gender: 'male', activity: 1.55 }; weightHistory = data.weightHistory || [];
                if(weightHistory.length === 0 && data.weight) weightHistory.push({ date: Date.now(), weight: parseFloat(data.weight) });
                if(data.date === dateKey) { cardioVal = data.cardio || 0; stepsVal = data.steps || 0; checks = data.checks || Array(10).fill(false); streakLocked = data.streakLocked || false; } 
                else { cardioVal = 0; stepsVal = 0; checks = Array(10).fill(false); streakLocked = false; saveData(); }
            }
        }

        function processProfilePic(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image(); img.src = e.target.result;
                    img.onload = function() {
                        const canvas = document.getElementById('resizeCanvas'); const ctx = canvas.getContext('2d'); const maxSize = 150; let w = img.width; let h = img.height; if (w > h) { if (w > maxSize) { h *= maxSize / w; w = maxSize; } } else { if (h > maxSize) { w *= maxSize / h; h = maxSize; } } canvas.width = w; canvas.height = h; ctx.drawImage(img, 0, 0, w, h);
                        profilePic = canvas.toDataURL('image/jpeg', 0.85); document.getElementById('profileImg').src = profilePic; saveData();
                    }
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // WEIGHT LOGIC
        function openWeightModal() { document.getElementById('weightModal').classList.remove('hidden'); document.getElementById('weightModal').classList.add('flex'); requestAnimationFrame(renderChart); }
        function closeWeightModal() { document.getElementById('weightModal').classList.add('hidden'); document.getElementById('weightModal').classList.remove('flex'); }

        function logNewWeight() {
            const wInput = document.getElementById('newWeightInput');
            const dInput = document.getElementById('weightDateInput');
            const val = parseFloat(wInput.value);
            if (!val || val <= 0 || val > 300) return;
            if (!dInput.value) { alert("Please select a date"); return; }
            const entryDate = new Date(dInput.value); entryDate.setHours(12, 0, 0, 0);
            weightHistory.push({ date: entryDate.getTime(), weight: val });
            weightHistory.sort((a, b) => a.date - b.date);
            wInput.value = ""; saveData(); refreshWeightUI();
        }

        function refreshWeightUI() {
            if(weightHistory.length === 0) { document.getElementById('displayWeight').innerText = "--"; document.getElementById('modalCurrentWeight').innerText = "-- KG"; return; }
            const latest = weightHistory[weightHistory.length - 1].weight;
            document.getElementById('displayWeight').innerText = latest;
            document.getElementById('modalCurrentWeight').innerText = latest + " KG";
            document.getElementById('modalWeightInput').value = latest; 
            const hM = stats.height / 100; const bmi = (latest / (hM * hM)).toFixed(1);
            let status = "", color = "";
            if(bmi < 18.5) { status = "UNDERWEIGHT"; color = "text-blue-600 bg-blue-100"; } else if(bmi < 25) { status = "HEALTHY"; color = "text-green-600 bg-green-100"; } else if(bmi < 30) { status = "OVERWEIGHT"; color = "text-orange-600 bg-orange-100"; } else { status = "OBESE"; color = "text-red-600 bg-red-100"; }
            const badge = document.getElementById('bmiDisplayMain'); badge.innerText = `BMI: ${bmi}`; badge.className = `mt-2 text-[9px] font-bold px-2 py-0.5 rounded inline-block uppercase ${color}`;
            calculateCalories(latest); renderChart(); renderHistoryList();
        }

        function renderHistoryList() {
            const list = document.getElementById('historyList'); list.innerHTML = "";
            const sortedDesc = [...weightHistory].sort((a, b) => b.date - a.date);
            sortedDesc.forEach((item) => {
                const originalIndex = weightHistory.indexOf(item);
                const d = new Date(item.date);
                const dateStr = d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                const el = document.createElement('div');
                el.className = "history-item glass p-4 rounded-xl flex justify-between items-center";
                el.innerHTML = `<span class="text-xs font-bold text-slate-500">${dateStr}</span><div class="flex items-center gap-3"><span class="text-lg font-black text-slate-800">${item.weight} KG</span><button onclick="requestDelete(${originalIndex})" class="w-8 h-8 flex items-center justify-center bg-red-50 text-red-500 rounded-full hover:bg-red-100 active:scale-90 transition">‚úï</button></div>`;
                list.appendChild(el);
            });
        }

        function requestDelete(index) { deleteIndex = index; document.getElementById('deleteModal').classList.remove('hidden'); document.getElementById('deleteModal').classList.add('flex'); }
        function cancelDelete() { document.getElementById('deleteModal').classList.add('hidden'); document.getElementById('deleteModal').classList.remove('flex'); deleteIndex = -1; }
        function confirmDelete() { if(deleteIndex > -1) { weightHistory.splice(deleteIndex, 1); saveData(); refreshWeightUI(); } cancelDelete(); }

        function renderChart() {
            const svg = document.getElementById('weightChart'); const width = svg.clientWidth; const height = svg.clientHeight; const padding = 5;
            if (weightHistory.length < 2) { document.getElementById('chartLine').setAttribute('d', ''); document.getElementById('chartDots').innerHTML = ''; return; }
            const maxScale = 110; 
            const points = weightHistory.map((d, i) => { const x = (i / (weightHistory.length - 1)) * width; const wClamped = Math.min(d.weight, 110); const y = height - (wClamped / maxScale) * (height - padding); return {x, y, w: d.weight}; });
            let dPath = `M ${points[0].x} ${points[0].y}`; points.forEach((p, i) => { if(i > 0) dPath += ` L ${p.x} ${p.y}`; });
            document.getElementById('chartLine').setAttribute('d', dPath);
            const dotsGroup = document.getElementById('chartDots'); dotsGroup.innerHTML = ''; 
            points.forEach(p => { const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle"); circle.setAttribute("cx", p.x); circle.setAttribute("cy", p.y); circle.setAttribute("r", "4"); circle.setAttribute("fill", "#3b82f6"); circle.setAttribute("stroke", "white"); circle.setAttribute("stroke-width", "2"); circle.setAttribute("class", "chart-dot"); dotsGroup.appendChild(circle); });
        }

        // --- STATS ---
        function openStatsModal() { if(weightHistory.length > 0) document.getElementById('modalWeightInput').value = weightHistory[weightHistory.length-1].weight; document.getElementById('statsModal').classList.remove('hidden'); document.getElementById('statsModal').classList.add('flex'); }
        function setGender(g) { stats.gender = g; updateGenderUI(); }
        function updateGenderUI() { const m = document.getElementById('btnMale'), f = document.getElementById('btnFemale'); const active = "bg-blue-600 text-white border-transparent shadow-md"; const inactive = "bg-slate-50 text-slate-400 border-slate-200"; if(stats.gender === 'male') { m.className = `flex-1 py-3 rounded-xl font-bold transition ${active}`; f.className = `flex-1 py-3 rounded-xl font-bold transition ${inactive}`; } else { f.className = `flex-1 py-3 rounded-xl font-bold transition ${active}`; m.className = `flex-1 py-3 rounded-xl font-bold transition ${inactive}`; } }
        function saveStats() {
            stats.age = parseFloat(document.getElementById('ageInput').value) || 25; stats.height = parseFloat(document.getElementById('heightInput').value) || 175; stats.activity = parseFloat(document.getElementById('activityInput').value);
            const modalW = parseFloat(document.getElementById('modalWeightInput').value);
            const currentW = weightHistory.length > 0 ? weightHistory[weightHistory.length-1].weight : 0;
            if(modalW && modalW !== currentW) { weightHistory.push({ date: Date.now(), weight: modalW }); weightHistory.sort((a,b)=>a.date-b.date); }
            saveData(); refreshWeightUI(); document.getElementById('statsModal').classList.add('hidden');
        }
        function calculateCalories(weight) { if(!weight) return; let bmr = (10 * weight) + (6.25 * stats.height) - (5 * stats.age) + (stats.gender === 'male' ? 5 : -161); const tdee = Math.round(bmr * stats.activity); document.getElementById('calMaintain').innerText = tdee; document.getElementById('calLoss').innerText = tdee - 500; document.getElementById('calGain').innerText = tdee + 300; }

        // --- UI ---
        function openModal() { document.getElementById('workoutModal').classList.remove('hidden'); document.getElementById('workoutModal').classList.add('flex'); }
        function closeModal() { document.getElementById('workoutModal').classList.add('hidden'); document.getElementById('workoutModal').classList.remove('flex'); }
        function switchTab(i) { currentTab = i; renderTabs(); renderExercises(); }
        function renderTabs() { const w = workouts[dayName]; document.getElementById('modalTabs').innerHTML = w.tabs.map((t, i) => `<button onclick="switchTab(${i})" class="flex-1 py-4 rounded-xl text-xs font-black uppercase tracking-widest transition-all ${currentTab === i ? 'bg-blue-600 text-white shadow-lg' : 'bg-white border border-slate-200 text-gray-400'}">${t}</button>`).join(''); }
        function renderExercises() {
            const w = workouts[dayName]; if(dayName === 'SUNDAY') { document.getElementById('modalExercises').innerHTML = '<div class="text-center mt-10 opacity-50 font-bold text-slate-800 text-xl">REST DAY</div>'; return; }
            const list = w.ex[currentTab], offset = currentTab * 5;
            document.getElementById('modalExercises').innerHTML = list.map((name, i) => { const id = offset + i; return `<label class="glass p-5 rounded-xl flex items-center gap-5 cursor-pointer active:scale-[0.99] transition-transform shadow-sm group select-none"><div class="relative shrink-0 w-8 h-8"><input type="checkbox" ${checks[id] ? 'checked' : ''} onchange="toggleCheck(${id}, this)" class="peer appearance-none w-full h-full rounded-lg border-2 border-slate-300 bg-white checked:bg-blue-600 checked:border-blue-600 transition-all"><svg class="absolute inset-0 m-auto w-5 h-5 text-white opacity-0 peer-checked:opacity-100 transition-opacity pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" /></svg></div><span class="text-base font-bold text-slate-800 leading-tight group-hover:text-blue-700 transition-colors">${name}</span></label>`; }).join('');
        }
        function toggleCheck(id, el) { checks[id] = el.checked; if(navigator.vibrate) navigator.vibrate(50); if(el.checked) confetti({ particleCount: 80, spread: 80, origin: { y: 0.6 }, colors: ['#FFD700', '#FF1493', '#F472B6', '#EAB308'] }); updateGymCircle(); saveData(); }
        function updateGymCircle() { const done = checks.filter(Boolean).length, pct = Math.round((done / 10) * 100); document.getElementById('circleRing').style.strokeDashoffset = 213 - (213 * pct / 100); document.getElementById('gymPercent').innerText = pct + "%"; if(done === 10 && !streakLocked) { streak++; streakLocked = true; } else if (done < 10 && streakLocked) { streak--; streakLocked = false; } document.getElementById('streakCount').innerText = streak; }
        function updateVal(type, val, save=true) { let v = parseInt(val), max = type === 'cardio' ? 30 : 10000; if(v > max) v = max; if(v < 0) v = 0; if(type === 'cardio') cardioVal = v; if(type === 'steps') stepsVal = v; document.getElementById(`${type}Input`).value = v; document.getElementById(`${type}Bar`).style.width = (v / max * 100) + '%'; if(save) saveData(); }
        function addVal(type, amt) { let curr = parseInt(document.getElementById(`${type}Input`).value); updateVal(type, curr + amt); }

        init();
    </script>
</body>
</html>
