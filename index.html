<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#ffffff">
<title>Wellness Dashboard Pro</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap');

    :root {
        --text-dark: #1F1F1F;
        --card-bg: rgba(255, 255, 255, 0.95);
        --c-orange: #FF9F1C;
        --c-red: #FF4D6D;
        --c-green: #2EC4B6;
        --c-blue: #3A86FF;
        --c-purple: #9D4EDD;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

    /* --- 1. ENDLESS BACKGROUND (10s Speed - Fixed Loop) --- */
    body {
        margin: 0;
        padding: 0;
        font-family: 'Poppins', sans-serif;
        min-height: 100vh;
        color: var(--text-dark);
        overflow-x: hidden;
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
        background-color: #f8f9fa;
    }

    /* GPU Background Layer */
    body::before {
        content: "";
        position: fixed;
        top: -50%; left: -50%; width: 200%; height: 200%;
        /* Start Color (#ff9a9e) MUST match End Color for seamless loop */
        background: linear-gradient(
            300deg, 
            #ff9a9e, #fad0c4, #fbc2eb, #a18cd1, 
            #84fab0, #8fd3f4, #a1c4fd, #c2e9fb,
            #ff9a9e
        );
        background-size: 400% 400%;
        animation: endlessBG 10s linear infinite; 
        z-index: -1;
        will-change: transform;
        transform: translate3d(0,0,0);
    }

    @keyframes endlessBG {
        0% { background-position: 0% 50%; }
        100% { background-position: 100% 50%; }
    }

    /* --- 2. STRIP ANIMATION (12s Speed) --- */
    @keyframes stripMove {
        0% { background-position: 0% 0%; }
        100% { background-position: 0% 200%; }
    }

    /* --- 3. BORDER ROTATION (Tabs & Pill) --- */
    @keyframes rotateBorder {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    @keyframes slideUpFade {
        from { opacity: 0; transform: translateY(12px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes popIn {
        0% { transform: scale(0.8); opacity: 0; }
        100% { transform: scale(1); opacity: 1; }
    }

    .app-container {
        max-width: 480px;
        margin: 0 auto;
        padding: 20px;
        padding-bottom: 120px;
    }

    /* --- HEADER --- */
    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-top: 10px;
    }

    .greeting-box { display: flex; flex-direction: column; }
    
    .greeting-label { 
        font-size: 11px; color: #555; font-weight: 700; 
        letter-spacing: 1.5px; margin-bottom: 4px; text-transform: uppercase;
        text-shadow: 0 1px 2px rgba(255,255,255,0.6);
    }
    
    .user-container { display: flex; align-items: center; gap: 8px; }

    .user-symbol {
        font-size: 28px; cursor: pointer; transition: transform 0.2s;
        display: inline-block; min-width: 30px; text-align: center; border-radius: 8px;
    }
    .user-symbol:active { transform: scale(1.1); background: rgba(255,255,255,0.5); }

    .user-name { 
        font-size: 28px; font-weight: 800; color: #111; 
        border-bottom: 2px dashed transparent; transition: border 0.3s;
        min-width: 50px; line-height: 1.2;
    }
    .user-name:focus { border-bottom-color: var(--c-blue); }

    /* --- DATE PILL (The Target Design) --- */
    .date-pill-wrapper {
        position: relative;
        padding: 2px;
        border-radius: 50px;
        background: linear-gradient(90deg, #FF9F1C, #FF4D6D, #9D4EDD, #3A86FF, #FF9F1C);
        background-size: 300% 300%;
        animation: rotateBorder 4s linear infinite; 
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .date-pill {
        background: rgba(255,255,255,0.9);
        padding: 8px 16px;
        border-radius: 48px;
        font-weight: 700;
        font-size: 13px;
        color: #333;
        display: flex; align-items: center;
    }

    /* --- WIDGET CARDS --- */
    .widget-card, .card-item {
        background: var(--card-bg);
        border-radius: 22px;
        padding: 20px;
        margin-bottom: 18px;
        box-shadow: 0 8px 25px -5px rgba(0,0,0,0.08);
        position: relative;
        overflow: hidden;
        border: 1px solid rgba(255,255,255,0.6);
        padding-left: 26px; 
        transform: translate3d(0,0,0);
    }
    .widget-card:active { transform: scale(0.98); transition: 0.1s; }

    /* Moving Left Strip (12s Speed) */
    .widget-card::before, .card-item::before {
        content: "";
        position: absolute;
        left: 0; top: 0; bottom: 0;
        width: 6px;
        z-index: 2;
        background-size: 100% 200%;
        animation: stripMove 12s linear infinite; 
    }

    /* Distinct Colors for Strips */
    .strip-orange::before { background-image: repeating-linear-gradient(180deg, #FF9F1C, #FF4D6D 50%, #FF9F1C 100%); }
    .strip-red::before { background-image: repeating-linear-gradient(180deg, #FF4D6D, #FF0055 50%, #FF4D6D 100%); }
    .strip-green::before { background-image: repeating-linear-gradient(180deg, #2EC4B6, #00FF99 50%, #2EC4B6 100%); }
    .strip-blue::before { background-image: repeating-linear-gradient(180deg, #3A86FF, #00D2FF 50%, #3A86FF 100%); }
    .strip-purple::before { background-image: repeating-linear-gradient(180deg, #9D4EDD, #C77DFF 50%, #9D4EDD 100%); }

    /* Content Typography */
    .cal-header { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 12px; }
    .cal-title { font-size: 13px; font-weight: 700; color: #888; text-transform: uppercase; letter-spacing: 0.5px; }
    .cal-val { font-size: 16px; font-weight: 800; color: var(--c-orange); }
    .progress-track { height: 10px; background: rgba(0,0,0,0.05); border-radius: 10px; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, #FF9F1C, #FF4D6D); width: 0%; border-radius: 10px; transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); }

    /* --- TABS (DATE PILL STYLE REPLICATION) --- */
    .cardio-tabs, .gym-tabs-container { 
        background: rgba(0,0,0,0.04); 
        border-radius: 50px; 
        display: flex; 
        padding: 4px; 
        margin-bottom: 18px; 
        gap: 5px; 
    }
    
    .c-tab, .gym-sub-tab { 
        flex: 1; text-align: center; padding: 10px; font-size: 13px; font-weight: 600; 
        border-radius: 48px; color: #888; cursor: pointer; transition: 0.2s; 
        border: none; background: transparent; font-family: 'Poppins', sans-serif;
        position: relative; z-index: 1;
        /* Default border transparent */
        border: 2px solid transparent;
    }

    /* Active Tab = Exact Date Pill Look */
    .c-tab.active, .gym-sub-tab.active {
        color: #111;
        /* This simulates the '2px' gradient border using background clips */
        background: 
            linear-gradient(#fff, #fff) padding-box,
            linear-gradient(90deg, #FF9F1C, #FF4D6D, #9D4EDD, #3A86FF, #FF9F1C) border-box;
        background-size: 300% 300%;
        animation: rotateBorder 4s linear infinite;
        border: 2px solid transparent;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .counter-display { font-size: 42px; font-weight: 800; line-height: 1; color: #111; margin-bottom: 8px; }
    .counter-unit { font-size: 16px; font-weight: 500; color: #888; }
    
    .ctrl-row { display: flex; justify-content: flex-end; gap: 12px; margin-top: 15px; }
    .ctrl-btn { width: 48px; height: 48px; border-radius: 50%; border: none; background: rgba(0,0,0,0.05); font-size: 22px; color: #333; display: flex; align-items: center; justify-content: center; cursor: pointer; }
    .ctrl-btn:active { background: rgba(0,0,0,0.1); }

    /* Grid */
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
    .tile { height: 160px; display: flex; flex-direction: column; justify-content: space-between; }
    .tile-icon { width: 44px; height: 44px; border-radius: 14px; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; }
    .tile-label { font-size: 11px; font-weight: 800; color: #AAA; text-transform: uppercase; }
    .tile-main { font-size: 18px; font-weight: 700; line-height: 1.3; color: #111; }
    .tile-sub { font-size: 12px; color: #888; font-weight: 500; margin-top: 4px; }
    .tile-long { display: flex; align-items: center; justify-content: space-between; height: auto; }
    
    /* --- OVERLAYS (OPAQUE) --- */
    .overlay { 
        position: fixed; inset: 0; 
        background: #F7F9FC; /* Solid opaque */
        z-index: 900; 
        transform: translateY(100%); 
        transition: transform 0.3s cubic-bezier(0.19, 1, 0.22, 1); 
        display: flex; flex-direction: column; 
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
        will-change: transform;
    }
    .overlay.open { transform: translateY(0); }
    
    .overlay-header { 
        padding: 20px 25px; 
        background: #FFFFFF; 
        display: flex; flex-direction: column; gap: 15px; 
        border-bottom: 1px solid rgba(0,0,0,0.05);
        box-shadow: 0 4px 15px rgba(0,0,0,0.02);
        z-index: 10;
    }
    .header-top { display: flex; justify-content: space-between; align-items: center; width: 100%; }
    .ov-title { font-size: 22px; font-weight: 800; color: #111; }
    .close-btn { 
        background: #F0F2F5; border: none; width: 36px; height: 36px; border-radius: 50%; 
        font-size: 20px; display: flex; align-items: center; justify-content: center; cursor: pointer; color: #555;
    }

    .overlay-content { 
        padding: 20px; 
        overflow-y: auto; 
        -webkit-overflow-scrolling: touch; 
        flex: 1; 
    }

    /* Gym Specifics */
    .gym-tabs-container { display: flex; gap: 8px; background: #F0F2F5; padding: 5px; border-radius: 50px; width: 100%; overflow-x: auto; scrollbar-width: none; flex-shrink: 0; }
    .gym-tabs-container::-webkit-scrollbar { display: none; }
    
    /* Removed .gym-hero from here as per request */

    /* Gym Item Layout */
    .card-item.gym-item { flex-direction: row; align-items: center; justify-content: space-between; padding: 20px; padding-left: 26px; }
    .gym-left { display: flex; align-items: center; gap: 15px; flex: 1; }
    
    .gym-centered-info { text-align: center; flex: 1; margin-right: 40px; }
    
    .gym-icon { width: 40px; height: 40px; border-radius: 10px; background: rgba(58, 134, 255, 0.1); color: var(--c-blue); display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
    
    /* Kept Gym Meta (Under Checkbox) */
    .gym-meta { font-size: 11px; color: #888; font-weight: 600; margin-top: 4px; display: flex; gap: 8px; justify-content: center; }
    .gym-tag { background: #F5F7FA; padding: 2px 6px; border-radius: 4px; }

    /* Lists */
    .card-item { display: flex; align-items: center; padding: 16px; margin-bottom: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); border: 1px solid #F0F0F0; animation: slideUpFade 0.4s ease forwards; opacity: 0; padding-left: 26px; }
    .card-item:nth-child(1) { animation-delay: 0.05s; }
    .card-item:nth-child(2) { animation-delay: 0.1s; }
    .card-item:nth-child(3) { animation-delay: 0.15s; }
    .card-item:nth-child(4) { animation-delay: 0.2s; }
    .card-item:nth-child(5) { animation-delay: 0.25s; }
    .card-item:nth-child(6) { animation-delay: 0.3s; }

    /* Checkbox */
    .cb-wrapper { position: relative; width: 26px; height: 26px; margin-right: 0; flex-shrink: 0; }
    .cb-wrapper input { position: absolute; opacity: 0; width: 100%; height: 100%; z-index: 5; cursor: pointer;}
    .cb-box { width: 100%; height: 100%; border: 2px solid #DDD; border-radius: 8px; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; background: #FAFAFA; }
    .cb-wrapper input:checked ~ .cb-box { background: var(--c-green); border-color: var(--c-green); animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    .cb-box::after { content: ''; width: 5px; height: 10px; border: solid white; border-width: 0 2px 2px 0; transform: rotate(45deg) scale(0); transition: 0.2s; margin-top: -2px; }
    .cb-wrapper input:checked ~ .cb-box::after { transform: rotate(45deg) scale(1); }

    .strip-blue .cb-wrapper input:checked ~ .cb-box { background: var(--c-blue); border-color: var(--c-blue); }
    .strip-purple .cb-wrapper input:checked ~ .cb-box { background: var(--c-purple); border-color: var(--c-purple); }

    .item-info { flex: 1; margin-left: 15px; }
    .time-badge { display: inline-block; font-size: 10px; font-weight: 700; color: #888; background: #F5F5F5; padding: 4px 8px; border-radius: 6px; margin-bottom: 5px; letter-spacing: 0.5px;}
    .item-title { font-size: 14px; font-weight: 600; color: #222; line-height: 1.4; }
    .cal-pill { display: inline-flex; align-items: center; font-size: 11px; font-weight: 700; color: var(--c-orange); background: rgba(255, 159, 28, 0.12); padding: 4px 10px; border-radius: 20px; margin-top: 6px; }

    #confetti-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; }
    svg { width: 24px; height: 24px; fill: currentColor; }
</style>
</head>
<body>

<canvas id="confetti-canvas"></canvas>

<div class="app-container">
    
    <div class="header">
        <div class="greeting-box">
            <span class="greeting-label">WELCOME BACK,</span>
            <div class="user-container">
                <span id="userSymbol" class="user-symbol" contenteditable="true">üëã</span>
                <div id="userName" class="user-name" contenteditable="true">User</div>
            </div>
        </div>
        <div class="date-pill-wrapper">
            <div class="date-pill" id="dateDisplay">Loading...</div>
        </div>
    </div>

    <div class="widget-card strip-orange" onclick="openOverlay('meal')">
        <div class="cal-header">
            <span class="cal-title">Daily Calories</span>
            <span class="cal-val" id="calText">0 / 0</span>
        </div>
        <div class="progress-track">
            <div class="progress-fill" id="calBar"></div>
        </div>
    </div>

    <div class="widget-card strip-red">
        <div class="cardio-tabs">
            <div class="c-tab active" id="tab-cardio" onclick="toggleCardio('cardio')">Cardio</div>
            <div class="c-tab" id="tab-steps" onclick="toggleCardio('steps')">Steps</div>
        </div>
        
        <div id="view-cardio">
            <div class="counter-display" id="cardioVal">0<span class="counter-unit"> min</span></div>
            <div style="height: 6px; background:#F0F0F0; border-radius:10px; overflow:hidden;">
                <div id="cardioProgress" style="width:0%; height:100%; background:var(--c-red); transition:0.3s;"></div>
            </div>
            <div class="ctrl-row">
                <button class="ctrl-btn" onclick="updateCardio(-5)">-</button>
                <button class="ctrl-btn" onclick="updateCardio(5)">+</button>
            </div>
        </div>

        <div id="view-steps" style="display:none;">
            <div class="counter-display" id="stepsVal">0<span class="counter-unit"> steps</span></div>
            <div style="height: 6px; background:#F0F0F0; border-radius:10px; overflow:hidden;">
                <div id="stepsProgress" style="width:0%; height:100%; background:var(--c-blue); transition:0.3s;"></div>
            </div>
            <div class="ctrl-row">
                <button class="ctrl-btn" onclick="updateSteps(-100)">-</button>
                <button class="ctrl-btn" onclick="updateSteps(100)">+</button>
            </div>
        </div>
    </div>

    <div class="grid-2">
        <div class="widget-card tile strip-green" onclick="openOverlay('meal')">
            <div>
                <div class="tile-icon" style="background:#E0F2F1; color:var(--c-green);">
                    <svg viewBox="0 0 24 24"><path d="M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2v7zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4z"/></svg>
                </div>
                <div class="tile-label">Next Meal</div>
                <div class="tile-main" id="nextMealName">Loading...</div>
                <div class="tile-sub" id="nextMealTime">--:--</div>
            </div>
        </div>

        <div class="widget-card tile strip-blue" onclick="openOverlay('gym')">
            <div>
                <div class="tile-icon" style="background:#E3F2FD; color:var(--c-blue);">
                    <svg viewBox="0 0 24 24"><path d="M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2 7.71l1.43 1.43L2 10.57 3.43 12 7 8.43 15.57 17 12 20.57 13.43 22 14.86 20.57 16.29 22 18.43 19.86 19.86 21.29 21.29 19.86l-1.43-1.43L22 16.29z"/></svg>
                </div>
                <div class="tile-label">Workout</div>
                <div class="tile-main" id="workoutNamePlan">Rest Day</div>
                <div class="tile-sub">Tap to View</div>
            </div>
        </div>
    </div>

    <div class="widget-card tile-long strip-purple" onclick="openOverlay('study')">
        <div style="display:flex; flex-direction:column;">
            <div class="tile-label" style="color:var(--c-purple);">Study Mode</div>
            <div class="tile-main">Focus Tasks</div>
        </div>
        <div class="tile-icon" style="background:#F3E5F5; color:var(--c-purple); margin-bottom:0;">
            <svg viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
        </div>
    </div>

</div>

<div id="overlay-meal" class="overlay">
    <div class="overlay-header">
        <div class="header-top">
            <span class="ov-title">Today's Meals</span>
            <button class="close-btn" onclick="closeOverlay()">√ó</button>
        </div>
    </div>
    <div class="overlay-content" id="list-meal"></div>
</div>

<div id="overlay-gym" class="overlay">
    <div class="overlay-header">
        <div class="header-top">
            <span class="ov-title">Gym Workout</span>
            <button class="close-btn" onclick="closeOverlay()">√ó</button>
        </div>
        <div id="gym-tabs-container" class="gym-tabs-container"></div>
    </div>
    <div class="overlay-content" id="list-gym"></div>
</div>

<div id="overlay-study" class="overlay">
    <div class="overlay-header">
        <div class="header-top">
            <span class="ov-title">Study Tasks</span>
            <button class="close-btn" onclick="closeOverlay()">√ó</button>
        </div>
    </div>
    <div class="overlay-content" id="list-study"></div>
</div>

<script>
    // --- MEAL DATA (WITH EXACT WEIGHTS) ---
    const mealData = {
        "Sunday": [
            { time: "5:00 AM", item: "Banana 120g + Roasted Chana 25g", cal: 190 },
            { time: "9:00 AM", item: "Protein Oats 60g + Milk 200ml + Chia 10g", cal: 374 },
            { time: "1:30 PM", item: "Chicken Breast 120g + Rice 100g", cal: 328 },
            { time: "4:30 PM", item: "Apple 150g + Roasted Chana 40g", cal: 210 },
            { time: "8:30 PM", item: "Goat Meat 130g + Wheat Roti 2 pcs", cal: 560 }
        ],
        "Monday": [
            { time: "5:00 AM", item: "Banana 120g + Chana 25g", cal: 190 },
            { time: "9:00 AM", item: "Protein Oats 60g + Milk 200ml + Chia 10g", cal: 374 },
            { time: "1:30 PM", item: "Moong Dal 100g + Black Chana 80g + Rice 120g", cal: 385 },
            { time: "4:30 PM", item: "Apple 150g + Roasted Chana 50g", cal: 250 },
            { time: "8:30 PM", item: "Soya Chunks 60g + Kabuli Chana 100g + Ghee 5g", cal: 415 }
        ],
        "Tuesday": [
            { time: "5:00 AM", item: "Banana 120g + Chana 25g", cal: 190 },
            { time: "9:00 AM", item: "Omelette (3 Eggs) + Brown Bread 2 slices", cal: 350 },
            { time: "1:30 PM", item: "Chicken Curry 150g + Rice 140g", cal: 450 },
            { time: "4:30 PM", item: "Apple 150g + Chana 40g", cal: 210 },
            { time: "8:30 PM", item: "Egg Bhurji (3 Eggs) + Salad 150g", cal: 360 }
        ],
        "Wednesday": [
            { time: "5:00 AM", item: "Banana 120g + Chana 25g", cal: 190 },
            { time: "9:00 AM", item: "Protein Oats 60g + Milk 200ml", cal: 325 },
            { time: "1:30 PM", item: "Chicken Breast 180g + Rice 120g", cal: 450 },
            { time: "4:30 PM", item: "Apple 150g + Seeds 10g", cal: 200 },
            { time: "8:30 PM", item: "Egg Curry (3 Eggs) + Salad 100g", cal: 360 }
        ],
        "Thursday": [
            { time: "5:00 AM", item: "Banana 120g + Chana 25g", cal: 190 },
            { time: "9:00 AM", item: "Protein Oats 60g + Seeds 15g", cal: 430 },
            { time: "1:30 PM", item: "Rajma 120g + Rice 150g", cal: 370 },
            { time: "4:30 PM", item: "Fruit 150g + Chana 40g", cal: 250 },
            { time: "8:30 PM", item: "Soya Chunks 60g + Veg Curry 200g", cal: 460 }
        ],
        "Friday": [
            { time: "5:00 AM", item: "Banana 120g + Chana 25g", cal: 190 },
            { time: "9:00 AM", item: "Omelette (3 Eggs) + Bread 2 slices", cal: 400 },
            { time: "1:30 PM", item: "Chicken Rice (High Protein)", cal: 480 },
            { time: "4:30 PM", item: "Fruit 150g + Chana 40g", cal: 200 },
            { time: "8:30 PM", item: "Egg Bhurji (3 Eggs) + Salad 150g", cal: 390 }
        ],
        "Saturday": [
            { time: "5:00 AM", item: "Banana 120g + Chana 25g", cal: 190 },
            { time: "9:00 AM", item: "Protein Oats 60g + Seeds 15g", cal: 430 },
            { time: "1:30 PM", item: "Dal 150g + Rice 120g + Salad", cal: 420 },
            { time: "4:30 PM", item: "Apple 150g + Chana 50g", cal: 250 },
            { time: "8:30 PM", item: "Soya Chunks 60g + Kabuli Chana 100g", cal: 475 }
        ]
    };

    // --- GYM DATA ---
    const workoutMonday = [
        { part: "Chest", ex: ["Barbell Bench Press", "Incline Dumbbell Press", "Chest Fly", "Cable Crossover", "Decline Bench Press"] },
        { part: "Triceps", ex: ["Close Grip Bench Press", "Skull Crushers", "Tricep Pushdown", "Overhead Dumbbell Extension", "Tricep Kickbacks"] },
        { part: "Bodyweight", ex: ["Push-ups", "Dips"] }
    ];
    const workoutTuesday = [
        { part: "Back", ex: ["Deadlift", "Lat Pulldown", "Seated Cable Row", "Bent Over Row", "T-Bar Row"] },
        { part: "Biceps", ex: ["Barbell Curl", "Dumbbell Curl", "Hammer Curl", "Concentration Curl", "Cable Curl"] },
        { part: "Bodyweight", ex: ["Pull-ups"] }
    ];
    const workoutWednesday = [
        { part: "Legs", ex: ["Squats", "Leg Press", "Lunges", "Leg Curl", "Leg Extension"] },
        { part: "Shoulders", ex: ["Overhead Press", "Lateral Raise", "Front Raise", "Rear Delt Fly", "Shrugs"] }
    ];

    const gymData = {
        "Monday": workoutMonday,
        "Tuesday": workoutTuesday,
        "Wednesday": workoutWednesday,
        "Thursday": workoutMonday,
        "Friday": workoutTuesday,
        "Saturday": workoutWednesday,
        "Sunday": [
            { part: "Recovery", ex: ["Light Cardio", "Stretching", "Mobility", "Core Training"] }
        ]
    };
    
    const studyTasks = [
        { id: 's1', task: 'Review HTML/CSS', time: '30 min' },
        { id: 's2', task: 'Algorithm Practice', time: '45 min' },
        { id: 's3', task: 'Project Building', time: '60 min' }
    ];

    // --- APP LOGIC ---
    const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
    let currentOverlay = null;
    let activeGymTab = 0; 

    function init() {
        const now = new Date();
        const dayName = days[now.getDay()];
        
        document.getElementById('dateDisplay').innerText = `${dayName.substring(0,3).toUpperCase()}, ${now.getDate()} ${now.toLocaleString('default', { month: 'short' }).toUpperCase()}`;
        
        const storedName = localStorage.getItem('user_name');
        const storedSymbol = localStorage.getItem('user_symbol');
        
        if(storedName) document.getElementById('userName').innerText = storedName;
        if(storedSymbol) document.getElementById('userSymbol').innerText = storedSymbol;

        const nameEl = document.getElementById('userName');
        const symEl = document.getElementById('userSymbol');

        const preventEnter = (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                e.target.blur();
            }
        };
        nameEl.addEventListener('keydown', preventEnter);
        symEl.addEventListener('keydown', preventEnter);

        nameEl.addEventListener('input', (e) => localStorage.setItem('user_name', e.target.innerText));
        symEl.addEventListener('input', (e) => localStorage.setItem('user_symbol', e.target.innerText));

        loadCardioState();
        updateDashboard(dayName);
        
        const storedDate = localStorage.getItem('last_active_date');
        const todayKey = now.toDateString();
        if (storedDate !== todayKey) {
            localStorage.setItem('checked_items', JSON.stringify([]));
            localStorage.setItem('cardio_min', '0');
            localStorage.setItem('steps_count', '0');
            localStorage.setItem('last_active_date', todayKey);
            location.reload(); 
        }
    }

    function updateDashboard(dayName) {
        const meals = mealData[dayName] || [];
        const now = new Date();
        let nextMeal = meals.find(m => {
            let parts = m.time.split(/[: ]/);
            let h = parseInt(parts[0]);
            let min = parseInt(parts[1]);
            if(parts[2] === "PM" && h !== 12) h += 12;
            if(parts[2] === "AM" && h === 12) h = 0;
            let mealTime = new Date();
            mealTime.setHours(h, min, 0);
            return mealTime > now;
        });
        if(!nextMeal && meals.length > 0) nextMeal = meals[0]; 
        if (nextMeal) {
            let name = nextMeal.item.split(/\d/)[0].trim();
            document.getElementById('nextMealName').innerText = name.substring(0,12) + "...";
            document.getElementById('nextMealTime').innerText = `At ${nextMeal.time}`;
        }
        const workout = gymData[dayName];
        if(workout) {
            const parts = workout.map(w => w.part).join(" & ");
            const displayTitle = parts.length > 18 ? parts.substring(0, 18) + "..." : parts;
            document.getElementById('workoutNamePlan').innerText = displayTitle;
        }
    }

    function toggleCardio(type) {
        document.querySelectorAll('.c-tab').forEach(t => t.classList.remove('active'));
        document.getElementById(`tab-${type}`).classList.add('active');
        document.getElementById('view-cardio').style.display = type === 'cardio' ? 'block' : 'none';
        document.getElementById('view-steps').style.display = type === 'steps' ? 'block' : 'none';
    }

    function updateCardio(amount) {
        let val = parseInt(localStorage.getItem('cardio_min') || 0) + amount;
        if(val < 0) val = 0;
        localStorage.setItem('cardio_min', val);
        loadCardioState();
    }
    
    function updateSteps(amount) {
        let val = parseInt(localStorage.getItem('steps_count') || 0) + amount;
        if(val < 0) val = 0;
        localStorage.setItem('steps_count', val);
        loadCardioState();
    }

    function loadCardioState() {
        const c = parseInt(localStorage.getItem('cardio_min') || 0);
        const s = parseInt(localStorage.getItem('steps_count') || 0);
        document.getElementById('cardioVal').innerHTML = `${c}<span class="counter-unit"> min</span>`;
        document.getElementById('cardioProgress').style.width = Math.min((c/30)*100, 100) + '%';
        document.getElementById('stepsVal').innerHTML = `${s}<span class="counter-unit"> steps</span>`;
        document.getElementById('stepsProgress').style.width = Math.min((s/10000)*100, 100) + '%';
    }

    window.openOverlay = function(type) {
        currentOverlay = `overlay-${type}`;
        document.getElementById(currentOverlay).classList.add('open');
        renderLists(days[new Date().getDay()]);
    }

    window.closeOverlay = function() {
        if(currentOverlay) {
            document.getElementById(currentOverlay).classList.remove('open');
            currentOverlay = null;
        }
    }

    window.setGymTab = function(index) {
        activeGymTab = index;
        renderLists(days[new Date().getDay()]);
    }

    function renderLists(dayName) {
        const checked = JSON.parse(localStorage.getItem('checked_items') || "[]");
        
        // Meal
        let mData = mealData[dayName] || [];
        let totalCal = 0, eatenCal = 0;
        let mHtml = '';
        mData.forEach((m, i) => {
            let id = `meal-${i}`;
            let isChecked = checked.includes(id);
            totalCal += m.cal;
            if(isChecked) eatenCal += m.cal;
            mHtml += createMealRow(id, m.item, m.time, `${m.cal} kcal`, isChecked, 'meal');
        });
        if(document.getElementById('list-meal')) document.getElementById('list-meal').innerHTML = mHtml;

        document.getElementById('calText').innerText = `${eatenCal} / ${totalCal}`;
        document.getElementById('calBar').style.width = totalCal ? (eatenCal/totalCal)*100 + '%' : '0%';

        // Gym (Fixed Logic)
        const gymGroups = gymData[dayName] || [];
        const gymTabsContainer = document.getElementById('gym-tabs-container');
        const gymListContainer = document.getElementById('list-gym');

        if(gymTabsContainer && gymListContainer) {
            if(gymGroups.length > 1) {
                // FIXED: Use a data-attribute to detect day change vs just internal update
                let currentDayAttr = gymTabsContainer.getAttribute('data-day');
                
                if(currentDayAttr !== dayName) {
                    let tabsHtml = '';
                    gymGroups.forEach((group, idx) => {
                        tabsHtml += `<button class="gym-sub-tab" onclick="setGymTab(${idx})">${group.part}</button>`;
                    });
                    gymTabsContainer.innerHTML = tabsHtml;
                    gymTabsContainer.setAttribute('data-day', dayName); // Update tracker
                    gymTabsContainer.style.display = 'flex';
                }
                
                // Active State Update
                Array.from(gymTabsContainer.children).forEach((btn, idx) => {
                    if(idx === activeGymTab) btn.classList.add('active');
                    else btn.classList.remove('active');
                });

            } else {
                gymTabsContainer.style.display = 'none'; 
                activeGymTab = 0;
            }

            if(!gymGroups[activeGymTab]) activeGymTab = 0;

            const currentGroup = gymGroups[activeGymTab];
            if(currentGroup) {
                let gymHtml = '';
                currentGroup.ex.forEach((exercise, exIdx) => {
                    const dayIdx = days.indexOf(dayName);
                    const id = `gym-${dayIdx}-${activeGymTab}-${exIdx}`;
                    const isChecked = checked.includes(id);
                    gymHtml += createProGymRow(id, exercise, isChecked);
                });
                gymListContainer.innerHTML = gymHtml;
            } else {
                gymListContainer.innerHTML = '<div style="text-align:center;color:#999;margin-top:20px;">Rest Day</div>';
            }
        }
        
        // Study
        let sHtml = '';
        studyTasks.forEach(s => {
            sHtml += createMealRow(s.id, s.task, s.time, "Focus", checked.includes(s.id), 'study');
        });
        if(document.getElementById('list-study')) document.getElementById('list-study').innerHTML = sHtml;
    }

    function createMealRow(id, title, time, cal, isChecked, type = 'meal') {
        let emoji = 'üçΩÔ∏è';
        if(time.includes("AM")) emoji = 'üåÖ';
        if(time.includes("PM")) {
            let hour = parseInt(time.split(':')[0]);
            if(hour >= 8 && hour != 12) emoji = 'üåô'; 
            else emoji = 'üçõ'; 
        }
        let stripClass = type === 'study' ? 'strip-purple' : 'strip-green';
        return `
            <div class="card-item ${stripClass}">
                <label class="cb-wrapper">
                    <input type="checkbox" id="${id}" ${isChecked ? 'checked' : ''} onchange="toggleCheck('${id}', event)">
                    <div class="cb-box"></div>
                </label>
                <div class="item-info">
                    <span class="time-badge">${emoji} ${time}</span>
                    <div class="item-title">${title}</div>
                    <div class="cal-pill">üî• ${cal}</div>
                </div>
            </div>
        `;
    }

    function createProGymRow(id, title, isChecked) {
        // Clean Title (Remove 1. 2. etc)
        let cleanTitle = title.replace(/^\d+\.\s*/, '');
        
        let iconChar = 'üí™';
        let lowerTitle = cleanTitle.toLowerCase();
        if(lowerTitle.includes('bench') || lowerTitle.includes('barbell') || lowerTitle.includes('squat') || lowerTitle.includes('deadlift')) iconChar = 'üèãÔ∏è';
        else if(lowerTitle.includes('dumbbell') || lowerTitle.includes('curl') || lowerTitle.includes('fly')) iconChar = 'ü¶æ';
        else if(lowerTitle.includes('cable') || lowerTitle.includes('pull')) iconChar = '‚õìÔ∏è';
        else if(lowerTitle.includes('bodyweight') || lowerTitle.includes('push-up') || lowerTitle.includes('dip')) iconChar = 'ü§∏';

        return `
            <div class="card-item gym-item strip-blue">
                <div class="gym-left">
                    <label class="cb-wrapper">
                        <input type="checkbox" id="${id}" ${isChecked ? 'checked' : ''} onchange="toggleCheck('${id}', event)">
                        <div class="cb-box"></div>
                    </label>
                    <div class="gym-centered-info">
                        <div class="item-title">${cleanTitle}</div>
                        <div class="gym-meta">
                            <span class="gym-tag">3 Sets</span>
                            <span class="gym-tag">8-12 Reps</span>
                        </div>
                    </div>
                </div>
                <div class="gym-icon">${iconChar}</div>
            </div>
        `;
    }

    window.toggleCheck = function(id, event) {
        let checked = JSON.parse(localStorage.getItem('checked_items') || "[]");
        const box = document.getElementById(id);
        if(box.checked) {
            checked.push(id);
            const rect = event.target.closest('.cb-wrapper').getBoundingClientRect();
            const x = rect.left + rect.width / 2;
            const y = rect.top + rect.height / 2;
            triggerHistoryBlast(x, y);
        } else {
            checked = checked.filter(i => i !== id);
        }
        localStorage.setItem('checked_items', JSON.stringify(checked));
        renderLists(days[new Date().getDay()]); 
    }

    function triggerHistoryBlast(x, y) {
        if(navigator.vibrate) navigator.vibrate([30, 40, 30]);
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        const particles = [];
        const colors = ['#FFD700', '#DAA520', '#EEE8AA', '#32CD32', '#228B22', '#00FF7F', '#FFFFFF'];
        
        for(let i=0; i<100; i++) { 
            const angle = (Math.random() * Math.PI * 2);
            const velocity = Math.random() * 18 + 5; 
            particles.push({
                x: x, y: y, size: Math.random() * 5 + 3,
                color: colors[Math.floor(Math.random()*colors.length)],
                vx: Math.cos(angle) * velocity, vy: Math.sin(angle) * velocity,
                life: 100, gravity: 0.6, drag: 0.94,
                rotation: Math.random() * 360, rotationSpeed: (Math.random() - 0.5) * 10
            });
        }
        
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            let active = false;
            particles.forEach(p => {
                if(p.life > 0) {
                    active = true;
                    p.x += p.vx; p.y += p.vy; p.vy += p.gravity;
                    p.vx *= p.drag; p.vy *= p.drag; p.life -= 1.2;
                    p.rotation += p.rotationSpeed;
                    ctx.save();
                    ctx.translate(p.x, p.y);
                    ctx.rotate(p.rotation * Math.PI / 180);
                    ctx.globalAlpha = Math.max(0, p.life / 100);
                    ctx.fillStyle = p.color;
                    ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size);
                    ctx.restore();
                }
            });
            if(active) requestAnimationFrame(animate);
            else ctx.clearRect(0,0,canvas.width,canvas.height);
        }
        animate();
    }

    init();

</script>
</body>
</html>
